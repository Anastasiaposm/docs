******************************************************
Настройка обмена данными между интернет-магазином и 1С
******************************************************

Инструкция по настройке обмена данными между 1С и интернет-магазином на платформе CS-Cart или Multi-Vendor.

.. contents:: Содержание
    :local: 
    :depth: 3


Настройки в 1С
--------------

Для начала работы с 1С откройте базу данных, с которой будет производиться обмен. 

Для этого запустите файл "1сv8.exe", в открывшемся окне выберите базу данных, с которой будет производиться обмен, и нажмите на кнопку "1С:Предприятие".

.. fancybox:: img/1Cimage_1.PNG
    :alt: Обмен данными 1C и CS-Cart

После запуска необходимо выбрать пользователя и ввести пароль (если у пользователя задан пароль).

.. fancybox:: img/1Cimage_2.PNG
    :alt: Обмен данными 1C и CS-Cart

Если пользователь и пароль введены правильно, откроется окно "Демонстрационная база".

.. fancybox:: img/1Cimage_3.PNG
    :alt: Обмен данными 1C и CS-Cart

Настройте обмен с интернет-магазином
====================================

Сначала нужно настроить обмен с интернет-магазином.

1.  В программе 1С:Предприятие зайдите в "Администрирование" и нажмите на ссылку "Настройки синхронизации данных". В окне "Настройки синхронизации данных" включите "Обмен данными с сайтами".

    .. fancybox:: img/1Cimage_4.PNG
        :alt: Обмен данными 1C и CS-Cart

2.  Нажмите на ссылку "Общие настройки" и включите "Дополнительные реквизиты и сведения"

    .. fancybox:: img/1Cimage_5.PNG
        :alt: Обмен данными 1C и CS-Cart

3.  Нажмите на ссылку "CRM и продажи" в левом меню и включите "Заказы клиентов" в появившейся форме.

    .. fancybox:: img/1Cimage_6.PNG
        :alt: Обмен данными 1C и CS-Cart


Создайте типовое соглашение с клиентами
=======================================

После необходимой настройки обмена создайте типовое соглашение с клиентами, для этого пройдите в раздел "Маркетинг и планирование" и нажмите на ссылку "Типовые соглашения с клиентами".

1.  В окне "Типовые соглашения об условиях продаж" нажмите на кнопку "Создать".

    .. fancybox:: img/1Cimage_7.PNG
        :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

2.  В новом окне "Типовое соглашение об условиях продаж" заполните все неоходимые поля, при этом:

    *   поле "Статус" должно иметь значение "Действует"; 

    *   поле "Сегмент партнеров" должно быть пустым;

    *   поле "Доступно внешним пользователем" должно быть отмечено галочкой.

    .. fancybox:: img/1Cimage_8.PNG
        :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

3.  Создайте новый узел обмена. Для этого пройдите в "Администрирование" и нажмите на ссылку "Настройки синхронизации данных". В окне "Настройки синхронизации данных" нажмите на ссылку "Узлы обмена с сайтами" и создайте новый узел.

    .. fancybox:: img/1Cimage_9.PNG
        :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

4.  В окне создания нового узла необходимо настроить процесс обмена.

    .. fancybox:: img/1Cimage_10.PNG
        :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

Настройка процесса обмена (узел обмена)
=======================================

Вкладка "Основные настройки"
****************************

Во вкладке "Основные настройки" узла обмена заполните следующие поля:

.. list-table::
    :widths: 10 30

    *   -   Наименование

        -   Введите наименование обмена

    *   -   "Режим обмена данными"

        -   *   "Выгрузка товаров", если планируется выгрузка товаров на сайт;

            *   "Обмен заказами", если планируется загрузка и выгрузка заказов.

    *   -   Выберите назначение обмена

        -   *   "Выгружать на сайт" - для выгрузки данных на сайт. 

                Если выбрано данное назначение, то в поле "Адрес сайта" введите путь к скрипту, который будет обрабатывать обмен (например, http://my_site.ru/app/addons/rus_exim_1c/exim_1c.php).

                .. important::

                    Также необходимо ввести имя пользователя интернет-магазина и его пароль. 

                Для проверки соединения нажмите кнопку "Проверить соединение". Если все параметры заполнены корректно, будет показано сообщение "Соединение успешно установлено". В противном случае необходимо проверить корректность введеного адреса и параметров доступа. 

                .. important::

                    Если проверка соединения проходит неудачно, обмен работать не будет.

                В процессе обмена, товарам загруженным из 1С в поле "Магазин" будет записано название магазина, имя и пароль администратора которого указано в настройках узла обмена в 1С.

            *   "Выгружать в каталог на диске" - для выгрузки данных в файл. 

                Если выбранно данное назначение, то необходимо указать путь к каталогу, куда будут выгружаться данные.

    *   -   Выберите контроль изменений:

        -   *   "Полная выгрузка" - выгрузка всех товаров и заказов, соответствующих условиям выгрузки.

            *   "Выгружать только измененные объекты" - выгрузка объектов, измененных с момента последней удачной выгрузки.

    *   -   "Использовать периодический обмен данными"

        -   Для автоматического обмена данными включите "Использовать периодический обмен данными" и настройте расписание обмена, чтобы обмен запускался автоматически когда это необходимо.

            .. fancybox:: img/1Cimage_11.PNG
                :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

Вкладка "Выгрузка товаров"
**************************

Во вкладке "Выгрузка товаров" заполните поля (вкладка доступна и видна, если включен флажок "Выгрузка товаров" на вкладке "Основные настройки"):

.. fancybox:: img/1Cimage_12.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

.. list-table::
    :widths: 15 30

    *   -   Организацию-владельца XML-каталога

        -   Это организация, от имени которой будет производиться обмен.

    *   -   Коэффициент пересчета веса

        -   Если необходимо будет производить пересчет веса товаров из 1С в единицы, в которых он учитывается на сайте.

    *   -   Выгружать файлы изображений

        -   Если необходимо выгружать изображения.

    *   -   Выгружать прочие файлы

        -   Если номенклатура содержит присоединенные файлы.

    *   -   Классифицировать по видам номенклатуры

        -   Если необходимо чтобы категории товаров выгружались из справочника "Виды номенклатуры", иначе категории будут выгружаться из справочника "Номенклатура".

    *   -   Таблица каталогов

        -   При необходимости настройте таблицу каталогов, которая содержит строки, для соответствия групп товаров категориям в интернет магазине.

**Настройки "Таблицы каталогов"**

*   В колонке "Каталог" задается имя каталога, 

*   В колонке "Группы номенклатуры" настраивается фильтр выгрузки групп (состав выбираемых групп зависит от установки флажка "Классифицировать по видам номенклатуры"): 

    -   Если флажок "Классифицировать по видам номенклатуры" включен, то группы выбираются из справочника "Виды номенклатуры", иначе – из справочника "Номенклатура".

    -   Если группы не выбраны, то выгружаться будут все группы. В колонке "Идентификатор каталога" задается идентификатор, по которому устанавливается связь выгружаемых данных с конкретными категориями в интернет магазине.

*   Для настройки отбора нажмите кнопку "Настроить отбор". В форме настройки отбора установите ограничения по выгрузке товаров. 

.. fancybox:: img/1Cimage_13.PNG
    :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)


Вкладка "Обмен заказами"
************************

Вкладка "Обмен заказами" (вкладка доступна и видна, если включен флажок "Обмен заказами" на вкладке "Основные настройки") содержит два раздела "Основные настройки обмена заказами" и "Дополнительно".

В разделе **"Основные настройки обмена заказами"** заполните следующие поля:

.. fancybox:: img/1Cimage_14.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

*   Заполните поля "Доп. реквизит документа Заказ клиента - Дата заказа на сайте" и "Доп. реквизит документа Заказ клиента - Номер заказа на сайте", по которым будет осуществляться поиск заказов с сайта.

*   Выберите "Способ идентификации контрагентов" для поиска контрагентов при загрузке заказов с сайта. Есть 2 варианта поиска: по наименованию и по комбинации ИНН+КПП. В обмене данными для CS-Cart необходимо использовать вариант "По наименованию".

*   Укажите "Вид номенклатуры (товар)" - вид номенклатуры, с которым будут записываться новые товары, загруженные с сайта.

*   Укажите "Вид номенклатуры (услуга)" - вид номенклатуры, с которым будут записываться новые услуги, загруженные с сайта.

*   Выберите "Единицу измерения новой номенклатуры" - единица измерения, с которой будут записываться новые товары с сайта.

*   В поле "Соглашение" выберите ранее созданное типовое соглашение с клиентами.

*   В поле "Организация" выберите организацию, от имени которой будет создаваться документ "Заказ клиента".

*   Заполните поле "Менеджер" для указания менеджера, от имени которого будут создаваться документы "Заказ клиента".

*   В поле "Комментарий" добавьте комментарий к документу "Заказ клиента", если это необходимо.

В разделе **"Дополнительно"** можно настроить дополнительные параметры обмена заказами:

.. fancybox:: img/1Cimage_15.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

*   "Параметры записи и проведения" - устанавливает режим записи и проведения документов.

*   "Параметры отмены заказов" - устанавливает статус заказа в случае, если он "Отменен" и причину, присваиваемому заказу в случае отмены.

*   "Соответствие статусов заказов" - настраивает соответствие статусов заказа на сайте статусам документа "Заказ клиента" в 1С. Если такие соответствия настроены, то при загрузке заказов будет происходить попытка установки соответствующего статуса документам "Заказ клиента".

После настройки всех необходимых параметров выгрузки сохраните узел, нажав на кнопку "Записать и закрыть".


Настройки в интернет-магазине
-----------------------------

Для обмена данными 1С с интернет-магазином установите модуль "Экспорт, импорт 1С" (:doc:`см. "Установка модулей" </manager/addons/install/index>`). 

.. note:: 

    Панель администратора → Верхнее меню → Модули → Управление модулями → "Экспорт, импорт 1С"

.. fancybox:: img/1Cimage_16.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

После установки модуля откройте его настройки. 

Окно "Настройки модуля" содержит вкладки:

*   Общие настройки, 

*   Настройки параметров и опций

*   Параметры доставки

*   Установка видов цен

*   Ограничение заказов

*   Ограничение загрузки характеристик


.. fancybox:: img/1Cimage_17.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

Общие настройки
===============

Вкладка "Общие настройки" содержит следующие поля:

.. fancybox:: img/1Cimage_18.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

.. list-table::
    :widths: 15 30

    *   -   Использовать в названии товара

        -   Параметр, определяющий какие данные будут записываться в наименование товара:

            *   Наименование 

            *   Полное наименование

    *   -   Использовать в артикуле товара

        -   Определяет какие данные будут записываться в поле артикула товара:

            *   Артикул номенклатуры

            *   Код номенклатуры

    *   -   Использовать изготовителя

        -   Будет выгружен изготовитель номенклатуры. Изготовитель будет добавлен в характеристику товаров "Бренд/Производитель".

    *   -   Скрывать товары с нулевым остатком.

        -   Будут скрыты товары с нулевым количеством.

    *   -   Добавлять налог к товарам.

        -   Товарам будут добавлены налоги, используемые в 1С. 

            Настройки выгрузки налогов доступны на странице:

            .. note::

                Модули → 1С → Цены и налоги из 1С.

                .. fancybox:: img/1Cimage_19.PNG
                    :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

            Для настройки выгрузки налогов необходимо указать соответствия налогов в CS-Cart и процентной ставкой в 1С.

    *   -   Использовать название страницы

        -   Параметр, определяющий будет ли использоваться название страницы "Наименование номенклатуры"

    *   -   Источник промо текста

        -   Параметр, определяющий какие данные будут записываться в промо-текст:
            
            *   Наименование

            *   Полное наименование

            *   Описание

            *   Свойство номенклатуры

    *   -   Наименование свойства

        -   Наименование свойства, значение которого будет записываться в поле "Промо-текст", если в параметре "Источник промо текста" выбрано значение "Свойство номенклатуры".


Настройка параметров и опций
============================
        
Вкладка "Настройка параметров и опций" содержит следующие настройки:

.. fancybox:: img/1Cimage_20.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

.. list-table::
    :widths: 15 30

    *   -   Имя опции

        -   Название выгружаемой опции для комбинации характеристик номенклатуры (для стандартного отображения характеристик номенклатуры)

            Значение по умолчанию: "Варианты".

    *   -   Создавать комбинацию с нулевым количеством.

        -   Будут созданы комбинации товаров с нулевым остатком.

    *   -   Способы отображения характеристик из 1С

        -   Необходимо выбрать способ отображения характеристик номенклатуры. 

            *   Стандартный способ - создается опция по комбинациям характеристик. 

            *   "По свойствам объекта" - создаются опции по каждой характеристике номенклатуры.

Параметры доставки
==================
    
Вкладка "Параметры доставки" настраивает загрузку дополнительных реквизитов номенклатуры (в одном поле можно указать несколько реквизитов для каждого вида номенклатуры с новой строки) и содержит следующие настройки:
    
.. fancybox:: img/1Cimage_21.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

.. list-table::
    :widths: 15 30

    *   -   Включать отдельно стоимость доставки заказа для 1С

        -   Доставка будет определена как отдельная номенклатура.

    *   -   Реквизит веса в 1С

        -   Выгружаемый дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.

    *   -   Отображать вес как характеристику

        -   По весу товара будет создана характеристика, для фильтра товаров по характеристикам.

    *   -   Бесплатная доставка

        -   Выгружаемый дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Булево.

    *   -   Отображать бесплатную доставку как характеристику

        -   По параметру "Бесплатная доставка товара" будет создана характеристика товара.

    *   -   Стоимость доставки

        -   Дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.

    *   -   Количество штук в коробке

        -   Дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.

    *   -   Длина коробки

        -   Дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.

    *   -   Ширина коробки

        -   Дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.

    *   -   Высота коробки

        -   Дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.


Виды цен
========
        
Вкладка "Установка видов цен" предназначена для возможности выгрузки нескольких видов цен и содержит следующие поля:

.. fancybox:: img/1Cimage_22.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

   
Выберите настройку **Использовать эту функцию** для выгрузки нескольких цен (Базовая цена, Рекомендованная цена, Оптовые цены). 

Выгрузка нескольких цен реализована с помощью цен для групп пользователей. Вы можете задать для каждой группы пользователей (Опт, Розница, Золотой клиент) свою цену на товар.

Для настройки выгрузки цен и соответствия цен группам пользователей в CS-Cart перейдите на страницу "Цены и налоги из 1С".

.. note::

    Верхнее меню → Модули → 1С → Цены и налоги из 1С.

Если существует необходимость выгрузки нескольких видов цен в одну цену, то их можно добавить в настройках через запятую.

Окно "Цены из 1С" содержит поля:

*   "Цена из 1С" - это цена, которая будет доступна для указанной группы пользователей; 

*   "Базовая цена" - это цена товара по умолчанию для всех групп пользователей; 

*   "Рекомендованная цена" - это рекомендованная цена товара в разделе "Ценообразование/наличие".
    
.. fancybox:: img/1Cimage_23.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)


Для проверки введенных названий цен (соглашений) в модуле предусмотрено тестирование выгружаемых цен. Для тестирования:

1.  Установите галочку "Запустить модуль в режиме отладки цен" в настройках модуля.
    
    .. fancybox:: img/1Cimage_24.PNG
       :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)

2.  В 1С произведите выгрузку в интернет-магазин (данные в магазин внесены не будут). Ответ сервера будет "Failure". 

3.  Далее перейдите на страницу "Цены и налоги из 1С" в панели администратора и посмотрите результат. Внесите исправление и обновите страницу. 

4.  Для полноценной выгрузки уберите галочку "Запустить модуль в режиме отладки цен" в настройках модуля "Экспорт, импорт 1С" и повторите выгрузку.


Ограничение заказов
===================
    
Вкладка "Ограничение заказов" содержит следующие поля:

.. fancybox:: img/1Cimage_25.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)
.. list-table::
    :widths: 15 30
    
    *   -   Использовать эту функцию
    
        -   Включает функцию фильтрации выгружаемых заказов из CS-Cart.

    *   -   Выгружать с номера
    
        -   Для загрузки будут доступны заказы, начиная с указанного номера.

    *   -   Статусы ордеров
    
        -   Фильтр загрузки заказов по статусам.


Ограничение загрузки характеристик
==================================

Вкладка "Ограничение загрузки характеристик" содержит следующие поля:

.. fancybox:: img/1Cimage_30.PNG
   :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)
.. list-table::
    :widths: 15 30
    
    *   -   Использовать эту функцию
    
        -   Включает функцию фильтрации загружаемых характеристик в CS-Cart.
        
    *   -   Загружать только/Не загружать

        -   Выбор метода исключения.

    *   -   Список характеристик
    
        -   Исключаемый/включаемый список характеристик(свойств номенклатуры). Каждая характеристика с новой строки.


Обмен данными между 1С и CS-Cart
--------------------------------

Обмен данными между 1С и CS-Cart можно осуществлять одним из способов:

*   Автоматический запуск
    
    Для автоматического запуска обмена достаточно настроить расписание автоматического обмена данными в форме узла обмена данными.

*   Ручной запуск 

    Для запуска обмена данными откройте созданный узел обмена и нажмите на кнопку "Синхронизация данных - Выполнить обмен данными", будет запущен процесс обмена, по окончании которого будет выдано соответствующее сообщение.


.. fancybox:: img/1Cimage_26.PNG
   :alt: Обмен данными 1C и CS-Cart и Multi-Vendor

Для анализа результатов обмена используется журнал регистрации «1С: Предприятия». 

Для просмотра событий выгрузки данных в окне созданного узла обмена необходимо нажать кнопку "Синхронизация данных - События выгрузки данных", откроется окно "Журнал регистрации".
    
.. fancybox:: img/1Cimage_27.PNG
    :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)
    
В форме "Журнал регистрации" для просмотра истории обмена открываются строки журнала и анализируется содержащаяся в них информация. Для быстрого просмотра протокола обмена по строке журнала достаточно нажать на поле "Комментарий" и откроется окно "Событие":
    
.. fancybox:: img/1Cimage_28.PNG
    :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)
    
Для просмотра и удаления объектов, зарегистрированных для выгрузки, в окне созданного узла обмена нажмите на кнопку "Синхронизация данных - Показать зарегистрированные изменения". В форме отображаются группы (виды) объектов: Товары, Файлы и Заказы. Если необходимо отменить (удалить) регистрацию конкретного объекта, необходимо выбрать его и нажать на кнопку [x]:
    
.. fancybox:: img/1Cimage_29.PNG
    :alt: Обмен данными 1C и CS-Cart (Multi-Vendor)