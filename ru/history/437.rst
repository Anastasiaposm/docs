*****
4.3.7
*****

==================================
Новая функциональность и улучшения
==================================

[+] Модули: Добавлен новый модуль "Определение местоположения".

[+] Модули: Платежи: Добавлена возможность создавать способы оплаты с помощью модуля, работающие в режиме iframe.

[+] Модули: Прайс-лист для Google Base: Добавлен код валюты в формат цены. Обновлен формат веса и добавлен символ меры. Добавлено свойство, которое исключает товары с нулевой ценой из экспорта.

[+] Налоги: Добавлена возможность задавать нулевое значение для налогов.

[+] Обратная связь: Добавлена новая информация для анализа.

[+] Отгрузки: Добавлены статусы для отгрузок, возможность обновления даты и комментария отгрузки.

[+] Панель администратора: Заказы: Хуки: Изменен хук "Select_popup: notify_checkboxes" и добавлены переменные статусов.

[+] Панель администратора: Поиск: Добавлен поиск товаров по нескольким ID.

[+] Редактор тем: Добавлена обратная совместимость.

[+] Хуки: Витрина: Добавлены новые хуки "index:body" и "index:html" в открывающие теги <body> и <html> соответственно.

[+] Хуки: Заказы: Добавлен новый хук "orders:order_total".

[+] Хуки: Языки: Добавлены хуки в методы "get", "getAll", "getSimpleLanguages" и "getAvailable".

[+] Центр обновлений: Восстановление: Добавлено удаление старых файлов ядра.

[+] {#6247} Модули: Синхронизация с eBay: Добавлены идентификаторы товаров eBay.

[+] {#6251} Модули: Конструктор форм: Теперь покупатели могут указывать тему писем, отправляемых через формы.

=========================================
Изменения в существующей функциональности
=========================================

[*] Модули: CommerceML: Добавлена настройка для выгрузки всех товаров в заказе.

[*] Модули: CommerceML: Изменен формат тегов для версии php7.

[*] Модули: Самовывоз: Добавлена настройка для отключения карты.

[*] Способы доставки: Добавлена возможность отслеживания номера посылки.

[*] Модули: Российские способы оплаты: В способах оплаты обновили функцию конвертации валют.

[*] Модули: Яндекс.Метрика: Добавлена статистика просмотра в быстром просмотре товара.

[*] Модули: Яндекс.Метрика: Добавлена статистика по купонам.

[*] Дизайн: Темы: Интерфейс страницы Дизайн → Темы улучшен для тем без стилей.

[*] Модули: Searchanise: Добавлена возможность искать товары по коду комбинации опций.

[*] Модули: Импорт магазина: Модуль Импорт магазина вырезан из дистрибутива и перенесен на Маркетплейс.

[*] Модули: Платежи через PayPal: Функция PayPal In-Context Checkout включена по умолчанию для новых установок.

[*] Оформление заказа: Способы доставки: Языковая переменная с инструкциями по способу доставки возвращена на страницу оформления заказа.

[*] Ядро: Режим лицензирования: Бесплатный режим удален.

==================
Исправления ошибок
==================

[!] Модули: CommerceML: 504 ошибка при обработке файла из 1С. Исправлено.

[!] Модули: CommerceML: Не обновлялись характеристики, для которых создана группа. Исправлено.

[!] Модули: CommerceML: При учете скидки в стоимости заказа, в теге "УчтеноВСумме" передавалось значение false. Исправлено.

[!] Модули: CommerceML: Для товаров с категорией, добавлялась категория выбранная по умолчанию. Исправлено.

[!] Модули: CommerceML: При обмене значение промо текста не очищалось. Исправлено.

[!] Модули: Города: При расчете доставки брался адрес, заданный по умолчанию. Исправлено.

[!] Модули: Города: В квитанции не отображался город плательщика. Исправлено.

[!] Модули: Почта России: Не работала ссылка отслеживания посылки. Исправлено.

[!] Модули: Стили и дополнения для русской темы: Новые посты появлялись только после перезагрузки страницы. Исправлено.

[!] Модули: Стили и дополнения для русской темы: Фатальная ошибка при выключении модуля комментариев. Исправлено.

[!] API: Общий контент: Нельзя было сделать объект общим с помощью параметра "share_objects". Исправлено.

[!] Registry: Значение Current URL было некорректным для нестандартных маршрутов. Исправлено.

[!] База данных: Выполнялись дополнительные SQL-запросы на загрузку данных, даже если главный запрос не возвращал результаты. Исправлено.

[!] Валюта: Если базовая валюта была недоступна для витрины, вторичная валюта отображалась в качестве базовой в панели администратора. Исправлено.

[!] Дизайн: Responsive: Список товаров: Информация о доставке отображалась неправильно в компактном списке. Исправлено.

[!] Дизайн: Блоки: Меню: Настройка Текстовых cсылок "Отображать элементы в одну строку" работала неправильно. Исправлено.

[!] Дизайн: Категории: Стрелки списка категорий отображались над блоком подменю. Исправлено.

[!] Дизайн: Оформление заказа: Способы оплаты: Инструкции по способу оплаты не отображались, если был выбран WYSIWYG-редактор. Исправлено.

[!] Дизайн: Редактор тем: Фон: Свойство прозрачности не работало в Internet Explorer 9. Исправлено.

[!] Дизайн: Редактор тем: Цветовой код на палитре становился нечитаемым после смены цвета. Исправлено.

[!] Дизайн: Редактор тем: Шрифты из раздела "Другие шрифты" и "Популярные шрифты" заменялись системными шрифтами после сохранения стиля. Исправлено.

[!] Дизайн: Список сравнения: Префикс и Постфикс отображались неправильно для харакеристики с типом "группа флажков". Исправлено.

[!] Дизайн: Товары: Быстрый просмотр: У всплывающих окон, содержимое которых подгружалось с помощью AJAX, была неправильная высота. Исправлено.

[!] Заказы: Поиск: Поиск заказов на витрине по стоимости использовал отключенную валюту. Исправлено.

[!] Заказы: Привилегии: Можно было обновлять некоторые данные заказа без соответствующих привилегий. Исправлено.

[!] Корзина: Способы доставки: Неправильно использовался адрес по умолчанию для определения местоположения пользователя. Исправлено.

[!] Менеджер блоков: Блоки без содержимого кэшировались. Исправлено.

[!] Модули: Блог: Менеджер блоков: Общие страницы и типы страниц отображались вместо Постов при редактировании блока на макете Блога. Исправлено.

[!] Модули: В сообщении об ошибке SQL, которое отображалось при удалении модуля, был неправильный текст. Исправлено.

[!] Модули: Импорт магазина: Если модуль Импорт магазина был установлен и отключен, при импорте данных отображалась страница 404. Исправлено.

[!] Модули: Комбинации товаров: Хуки: Параметра функции "$params" не было в хуке "buy_together_get_chains_pre". Исправлено.

[!] Модули: Модули, подключенные по относительным ссылкам, не работали. Исправлено.

[!] Модули: Обратный звонок: Капча генерировалась для каждого товара на странице. Исправлено.

[!] Модули: Обязательные товары: Когда покупатель добавлял товар в корзину, обязательные товары не добавлялись, если покупатель приобретал их ранее. Исправлено.

[!] Модули: Отзывы и комментарии: Название компании отсутствовало в теме сообщения для администратора. Исправлено.

[!] Модули: Отзывы и комментарии: Покупатель мог комментировать заказ другого покупателя. Исправлено.

[!] Модули: Отложенные товары: Список отложенных товаров пользователя оказывался пустым, когда администратор действовал от лица этого покупателя. Исправлено.

[!] Модули: Платежи через PayPal: У логотипа на странице оплаты через PayPal была HTTP-ссылка при включенном HTTPS-соединении для витрины. Исправлено.

[!] Модули: Платежи через PayPal: Формы на последнем шаге In-Context Checkout неправильно обрабатывались. Исправлено.

[!] Модули: Подарочные сертификаты: В режиме "Все магазины" нельзя было управлять статусами подарочных сертификатов. Исправлено.

[!] Модули: Рассылки: Название настройки "Показывать при регистрации" было неточным. Исправлено.

[!] Модули: Рассылки: Отключенные списки рассылки вызывали PHP-сообщения на странице управления рассылками. Рассылки отправлялись пользователям из отключенных списков рассылки. Обе проблемы исправлены.

[!] Модули: Рассылки: Существующих подписчиков нельзя было добавить в список рассылки. Исправлено.

[!] Модули: Теги: Отключенные теги отображались на карточке товара. Исправлено.

[!] Модули: Хиты продаж и товары со скидкой: На странице products.bestsellers появлялась ошибка SQL, если по умолчанию товары сортировались по хитам продаж. Исправлено.

[!] Опции: Шаблоны: Если поле "option_type" было пустым, во всплывающем окне редактирования опции появлялось сообщение об ошибке. Исправлено.

[!] Отладчик: Отладчик работал медленно при его активном использовании. Исправлено.

[!] Оформление заказа: Корзина: При выборе недоступной комбинации опций в корзине отображались PHP-сообщения, а также были проблемы с интерфейсом. Исправлено.

[!] Панель администратора: Поиск: Не работал поиск заказов по нескольким ID. Исправлено.

[!] Панель администратора: Страницы: Страницы в дереве страниц не сортировались по позиции. Исправлено.

[!] Панель администратора: Товары: Популярности товара нельзя было задать нулевое значение, если раньше его не задавали. Исправлено.

[!] Панель администратора: Фильтры товаров: Новые фильтры, добавленные на странице Товары → Фильтры, отображались неправильно на склонированной витрине. Исправлено.

[!] Письма: Невозможно было отправить письмо, если в поле "От" было несколько адресов. Исправлено.

[!] Поиск: Форма поиска не работала после возвращения со страницы результатов поиска в браузере Safari. Исправлено.

[!] Режим виджета: Процесс инициализации не продолжался, если был прерван переадресацией, что вызывало 500 ошибку. Исправлено.

[!] Способы оплаты: QB Merchant Service: Способ оплаты не работал из-за устаревшего API. Исправлено.

[!] Способы оплаты: Winbank: Неправильная реферальная ссылка отображалась в форме настройки способа оплаты. Исправлено.

[!] Страницы: Некоторые страницы не отображались в дереве страниц. Исправлено.

[!] Страницы: Параметры "page" и "items_per_page" проверялись некорректно. Исправлено.

[!] Темы: Модули: FTP: В окне для ввода данных FTP-доступа были неправильные пути к директории CS-Cart. Исправлено.

[!] Товары: Оптовые скидки: Если настройка "Состояние иконки «Обновить для всех магазинов» по умолчанию" была включена, оптовые скидки удалялись некорректно для выбранной компании.

[!] Товары: Опции: Недоступные комбинации: Если были включены свойства "Нельзя выбрать ни один из вариантов" и "Показывать предупреждение об исключении", предупреждение не показывалось. Также в браузере Chrome нельзя было выбрать опцию как радиогруппу. Обе проблемы исправлены.

[!] Товары: Поиск:  Неправильная логика выбора запасного варианта поля сортировки могла вызвать ошибку синтаксиса SQL. Исправлено.

[!] Товары: Фильтры: Можно было создать повторяющиеся фильтры. Исправлено.

[!] Товары: Фильтры: Фильтр оставался включенным, если отключить характеристику, по которой он работал. Исправлено.

[!] Товары: Фильтры: Фильтрация по цене работала неправильно после переключения валюты. Исправлено.

[!] Центр обновлений: Магазин с несколькими витринами нельзя было обновить, если для разных витрин были указаны разные email-адреса администраторов. Исправлено.

[!] Шаблоны: Календарь: Элемент выбора даты не работал, если был выбран RTL-язык. Исправлено.

[!] Экспорт/импорт: Оптовые скидки: При импорте оптовых скидок можно было создать пустой товар. Исправлено.

[!] Экспорт/импорт: Опции: Значения модификаторов не импортировались для опций типа "Флажок". Исправлено.

[!] Экспорт/импорт: Опции: Опции товара для вторичного языка обновлялись неправильно. Исправлено.

[!] Экспорт/импорт: Характеристики: Когда администратор создавал новую характеристику через импорт, ID характеритики не импортировался и генерировался автоматически. Исправлено.

[!] Экспорт/импорт: Характеристики: Экспорт и импорт характеристик товаров не поддерживал мультиязычность. Исправлено.

[!] Экспорт/импорт: Экспортировалась вся директория с изображениями, если у изображения было пустрое поле "image_path". Исправлено.

[!] Ядро: HTTP: Время ожидания подключения по умолчанию не было задано для запросов, выполняемых через cURL. Исправлено.

[!] Ядро: Заказы: Было несоответствие между условиями сохранения и загрузки описаний статусов заказов с несколькими витринами, поэтому отображались неправильные описания. Исправлено.

[!] Ядро: Изображения с расширением, указанным заглавными буквами, не загружались на витрине, которая находилась в подпапке. Исправлено.

[!] Ядро: Модули: Невозможно было установить модуль, в установочном архиве которого была подпапка. Исправлено.

[!] Ядро: Некоторые регулярные выражения работали неправильно на PHP 7. Исправлено.

[!] Ядро: Сессии: HTTPS: Данные сессии терялись после переадресации на страницу оформления заказа с защищенным соединением на отдельном домене. Исправлено.

[!] {#6201} Модули: Поддержка HiDPI: Некоторые изображения не работали, если у них не было копии для экранов Retina. Исправлено.

[!] {#6245} Управление заказами: Промо-акции: Автоматически сгенерированный код купона заменялся новым кодом после редактирования заказа. Исправлено.

[!] {#6246} Оформление заказа: При щелчке по кнопке "Получить расценки" адрес доставки, который указал гость, перезаписывался. В некоторых случаях нельзя было редактировать раздел "Адрес доставки и плательщика" после изменения адреса в окне расчета стоимости доставки. Исправлено.

[!] {#6248} Модули: Подарочные сертификаты: Модуль всегда использовал шаблон письма по умолчанию. Исправлено.

[!] {#6249} Оформление заказа: Расчет стоимости доставки: Способ доставки можно было выбрать, щелкнув по нему, а не нажав кнопку "Выберите способ доставки". Исправлено.

[!] {#6252} Дизайн: Отладчик: Стили: Ссылкам на панели инструментов не был присвоен цвет. Исправлено.

[!] {#6255} Товары: Фильтры: Товары не фильтровались по дробным ценам. Исправлено.

[!] {#6262} Промо-акции: Характеристики: Значение условия "Характеристика товара" типа "Другое->*" не отображалось после сохранения. Исправлено.

[!] {#6262} Промо-акции: Характеристики: После удаления товара из корзины отображалось PHP-сообщение, если была активна промо-акция с условием "Характеристика товара". Исправлено.

[!] {#6272} API: Обновление заказа: Доставка заказов с несколькими отгрузками обновлялась неправильно.

[!] {#6274} Блоки: Кэширование: Неправильно применялись условия кэширования, если один из элементов управления кэшированием не был найден. Исправлено.

[!] {#6282} Дизайн: Responsive: Меню: Меню отображалось неправильно на экранах шириной 767 пикселей. Исправлено.

[!] {#6284} Центр обновлений: Измененные файлы темы не отображались на странице "Локальные изменения". Исправлено.

[!] {#6287} Модули: Блог: Нельзя было задать порядок постов. Исправлено.

[!] {#6291} Модули: Импорт магазина не работал с двумя подключениями MySQL. Исправлено.

[!] {#6292} Языки: У экспортированных файлов ".po" была неверная структура заголовка. Исправлено.

[!] {#6296} Промо-акции: При проверке промо-акции проверялись все доступные условия, что ухудшало производительность. Исправлено.

[!] {#6298} Способы доставки: FedEx: При расчете стоимости доставки генерировались PHP-сообщения. Исправлено.

[!] {#6300} Промо-акции: Проверка условий промо-акции товара по опциями была излишне строгой, поэтому иногда не проходила. Исправлено.

[!] {#6310} Товары: Фильтры: Могло появиться PHP-сообщение при проверке доступных вариантов. Исправлено.

[!] {#6314} Установщик: Безопасность: Пароль администратора был "несоленый". Исправлено.

[!] {#6315} Товары: Комбинации опций: Если у товара и его первой комбинации опций не было кода, код второй комбинации не отображался в карточке товара. Исправлено.

[!] {#6316} MySQL: Если сервер MySQL падал, память переполнялась. Исправлено.

[!] {#6322} Модули: Теги: На витрине возникала ошибка после добавления блока "Теги" на макет. Исправлено.
