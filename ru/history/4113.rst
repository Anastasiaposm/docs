******
4.11.3
******

==================================
Новая функциональность и улучшения
==================================

[+] Витрины: Добавлена настройка, позволяющая ограничить доступ к витрине для неавторизованных пользователей.

[+] Заказы: На список заказов на витрине добавлены кнопки для повтора заказа, печати счёта и поиска товаров заказа.

[+] Модули: Массовое добавление товаров в корзину: Был добавлен модуль для быстрого добавления большого количества товаров в корзину.

[+] Модули: Склады [Beta]: Для настройки "Доставка в" у магазина/склада появилась возможность выбрать все тарифные зоны одним кликом.

[+] Модули: Чат с продавцом: Теперь уведомления о новых сообщениях появляются в Центре уведомлений.

[+] Настройки: Внешний вид: Просмотрщики изображений: Добавлен альтернативный просмотрщик изображений Swiper.

[+] Пользователи: Заказы: На списке покупателей и на детальной странице покупателя добавлено отображение количества совершенных заказов и их суммы.

=========================================
Изменения в существующей функциональности
=========================================

[*] Безопасность: Изменения в файлах copyright.txt and changelog.txt больше не учитываются в детекторе изменений ядра.

[*] Витрины: Панель администратора: Теперь если в режиме "Все магазины" администратор нажмёт на значок корзины в левом верхнем углу то попадёт на первую активную витрину.

[*] Дизайн: Оформление заказа: Опция "Пропустить оплату" для администраторов теперь появляется на странице оформления заказа только в режиме разработки.

[*] Дизайн: Темы: Теперь при изменении темы происходит полная очистка кэша.

[*] Корзина: Стоимость налога отображалась на странице корзины, но не включалась в сумму покупки, если в магазине запрещено вычислять примерную стоимость доставки на странице корзины. Исправлено.

[*] Модули:  Вариации товаров: Теперь у "Вариаций как один товар" на списке товаров отображается кнопка "Выберите вариацию" вместо кнопки "Добавить в корзину". Так больше вероятность, что покупатели выберут нужную вариацию.

[*] Модули: Склады [Beta]: CommerceML: Склады: Теперь к одному складу можно привязать несколько внешних идентификаторов из системы учёта.

[*] Модули: Служба доставки — СДЭК: В сообщении об отгрузке была изменена ссылка на сайт для отслеживания посылки.

[*] Привилегии: Незавершенные покупки: Теперь доступ к незавершённым покупкам даётся вместе с доступом к заказам, а не с доступом к пользователям.

[*] Пользователи: На списке пользователей дата регистрации заменена на дату последнего входа в учётную запись.

[*] Редактор тем: Оформление заказа: Цвета на странице оформления заказа теперь можно настроить.

[*] Фильтры: Теперь при создании фильтра удобнее выбирать характеристику, по которой будет производиться фильтрация.

==================
Исправления ошибок
==================

[!] Витрины: Когда администратор выбирал другую витрину в панели администратора, в некоторых случаях могла возникнуть ошибка PHP Notice. Исправлено.

[!] Витрины: Модули: Рассылки: Экспорт/Импорт: На странице экспорта/импорта подписчиков происходило циклическое перенаправление. Исправлено.

[!] Витрины: Регионы: Если у витрины был список стран, из которых на эту витрину перенаправлялись пользователи, то перенаправление происходило только для первой страны из списка. Исправлено.

[!] Внешний вид: Характеристики: Характеристика, которая отображалась как галочка, могла иметь значение. Это значение отображалось как подсказка к галочке. Исправлено.

[!] Дизайн: Нижняя панель инструментов для администратора: RTL: Нижняя панель инструментов для администратора не была адаптирована под RTL. Исправлено.

[!] Дизайн: Панель администратора: Уведомления могли показываться поверх меню шестерёнки. Исправлено.

[!] Дизайн: Редактор тем: В некоторых случаях возникала ошибка 404 при закрытии Редактора тем. Исправлено.

[!] Дизайн: Характеристики товара: Big picture: Опции отображались в две строки, даже если умещались в одну строку. Исправлено.

[!] Дизайн: Центр обновлений: Кнопка "Показать больше" перекрывала список файлов. Исправлено.

[!] Заказы: Отгрузки: После создания отгрузки ней отсутствовали имя и фамилия покупателя. Исправлено.

[!] Карты и геолокация: Карту Google нельзя было перемещать двумя пальцами. Исправлено.

[!] Макеты: Экспорт/Импорт: После сохранения макета его название добавлялось в имя файла при экспорте любого макета. Исправлено.

[!] Модули: Boxberry: Адрес покупателя на странице оформления заказа заменялся адресом ПВЗ. Исправлено.

[!] Модули: CommerceML: Если вариации были конвертированы из старых, а старые были созданы через CommerceML, то в некоторых случаях такие вариации неправильно обновлялись. Исправлено.

[!] Модули: CommerceML: При обновлении товаров из системы учёта обновлялась дата создания такого товара в самом магазине. Также в журнал обмена данными записывалось некорректное время операций, если они выполнялись после полудня. Исправлено.

[!] Модули: CommerceML: Характеристики со статусами "Выкл." или "Скрыто" не обновлялись при повторной выгрузке из системы учета. Исправлено.

[!] Модули: retailCRM [Beta]: Eсли товара не было в наличии на момент синхронизации заказа, то в заказе количество товара и сумма сбрасывались до 0. Исправлено.

[!] Модули: Вариации товаров: «С этим товаром часто покупают...»: Блок товаров, которые часто покупают вместе с выбранным, показывался только для дочерней вариации. Исправлено.

[!] Модули: Вариации товаров: В некоторых случаях страница вариации на витрине при открытии прокручивалась до вкладки c вариациями. Исправлено.

[!] Модули: Вариации товаров: Витрины: Нельзя было отредактировать цены у дочерних "вариаций как один товар" на дополнительных витринах. Исправлено.

[!] Модули: Вариации товаров: Названия дочерних вариаций не синхронизировались с вариацией по умолчанию после импорта. Исправлено.

[!] Модули: Вариации товаров: Отзывы и комментарии: Покупатель не мог оставить отзыв для товара, если выбрана не та вариация, которая была куплена и при этом настройка "Отзывы только от покупателей" активна. Исправлено.

[!] Модули: Вариации товаров: Экспорт/Импорт: Если в магазине не была создана характеристика, на которой основана вариация, то при импорте вариации вместе с этой характеристикой возникала ошибка SQL. Исправлено.

[!] Модули: Возврат товаров: Налоги на способ доставки не пересчитывались при перерасчете заказа во время смены статуса запроса на возврат.

[!] Модули: Вход через соцсети: Не удавалось авторизоваться через Twitter из-за изменений на их стороне. Исправлено.


[!] Модули: Деловые Линии: Не производился расчет стоимости доставки для города Дмитров (Московская область). Исправлено.

[!] Модули: Деловые Линии: Стоимость доставки рассчитывалась в неправильной валюте, когда базовой валютой не являлся российский рубль. Исправлено.

[!] Модули: Карты и геолокация: Стоимость доставки товара не пересчитывалась при изменении локации. Исправлено.

[!] Модули: Магазины и пункты самовывоза: В некоторых случаях способ доставки "Самовывоз" не отображался на странице оформления заказа. Исправлено.

[!] Модули: Магазины и пункты самовывоза: Мог отсутствовать список городов, содержащих магазины и пункты самовывоза для выбранной витрины. Исправлено.

[!] Модули: Магазины и пункты самовывоза: При оформлении заказа со способом доставки "Самовывоз" могла возникать ошибка PHP Notice. Исправлено.

[!] Модули: Магазины и пункты самовывоза: Склады [Beta]: Улучшен список пунктов самовывоза и складов в панели администратора.

[!] Модули: Обратный звонок: Витрины: При оформлении заказа с помощью модуля "Обратный звонок" он появлялся в панели администратора на всех витринах. Исправлено.

[!] Модули: Отзывы и комментарии: Заказы: У кнопки "Новое сообщение" было некорректное название. Исправлено.

[!] Модули: Отзывы и комментарии: Не было возможности оставить комментарий для товара на витрине, если он принадлежал другой витрине. Исправлено.

[!] Модули: Отзывы и комментарии: При сохранении заказа покупатель мог потерять возможность начать обсуждение, хотя она доступна по умолчанию в настройках модуля. Исправлено.

[!] Модули: Поставщики: При включенном модуле "Поставщики" при дублировании товара возникала ошибка PHP Notice. Исправлено.

[!] Модули: Пошаговое оформление заказа [Не рекомендуется]: Местоположение покупателя сбрасывалось на стандартное для магазина, если модуль был выключен. Исправлено.

[!] Модули: Расширенный импорт товаров: При попытке отредактировать пресет, принадлежащий отключенному продавцу, возникали ошибки PHP Notice. Исправлено.

[!] Модули: Склады [Beta]: В некоторых случаях импорт количества товара на определённый склад мог вызвать критическую ошибку. Исправлено.

[!] Модули: Социальные кнопки: Описание товара некорректно обрезалось для социальных сетей; это приводило к ошибке JS. Исправлено.

[!] Модули: Требуемые товары: Товар не добавлялся в список обязательных товаров, если его искали через расширенный поиск. Исправлено.

[!] Модули: Чат с продавцом: Форма авторизации: Если неверно ввести логин и пароль при включенном модуле "Чат с продавцом", то не отображалось сообщение о неверных данных. Исправлено.

[!] Незавершенные покупки: Витрины: При создании заказа через меню "Незавершенные покупки" информация о незавершённой покупке не удалялась, если товар не был добавлен через дополнительную витрину. Исправлено.

[!] Панель администратора: Заказы: В некоторых случаях товар мог не добавляться в заказ, редактируемый в панели администратора. Исправлено.

[!] Панель администратора: Модули: Склады [Beta]: Перевод текста заголовка таблицы не отображался в мобильной версии. Исправлено.

[!] Промо-акции: Появлялась ошибка PHP при сохранении промо-акции под витриной. Исправлено.

[!] Редактирование контента: При попытке отредактировать языковую переменную "Разместить заказ" на странице размещения заказа возникала ошибка. Исправлено.

[!] Способы оплаты: Sage Pay: Почта: Почтовые уведомления не отправлялись после оплаты заказа. Исправлено.

[!] Темы: Тема могла быть удалена, несмотря на то, что она была активна на одной из витрин. Исправлено.

[!] Товары: Изображения: Если открыть, а затем закрыть просмотрщик изображений, то страница не прокручивалась в IE11. Исправлено.

[!] Товары: Категории: Не сохранялось изменение основной категории товара при его редактировании. Исправлено.

[!] Фильтры: Поиск: В режиме продавца на странице  Товары-Фильтры не отображалась кнопка "Поиск". Исправлено.

[!] Экспорт/Импорт: Ссылка в сообщении о неверном диапазоне экспорта вела на страницу 403. Исправлено.

[!] Ядро: Кэширование: В панели администратора неправильно кэшировались настройки модулей. Исправлено.

[!] Ядро: Модули: При установке модуля из архива "опасным способом" файлы из директории design/themes/templates/addons удалялись без замены новыми загруженными файлами. Исправлено.

[!] JS: WYSIWYG: Redactor II: При удалении символов из текста удалялись стили. Исправлено.


[!] Multi-Vendor: Бухгалтерский учёт: Отрицательная величина дохода в панели продавца отображалась некорректно. Исправлено.

[!] Multi-Vendor: Модули: Pickpoint: Модуль нельзя было включить. Исправлено.

[!] Multi-Vendor: Модули: Выплата долгов продавцов: Валюта, выбранная в панели продавца, не меняла валюту в корзине. Исправлено.

[!] Multi-Vendor: Модули: Выплата долгов продавцов: Долг продавца мог остаться невыплаченным даже после полной оплаты задолженности. Исправлено.

[!] Multi-Vendor: Модули: Магазины и пункты самовывоза: Неправильно работал способ доставки "Самовывоз", особенно когда покупатель в одном заказе покупал товары сразу у нескольких продавцов. Исправлено.

[!] Multi-Vendor: Модули: Почта России: Продавцы видели сообщение "Доступ запрещён" на странице настроек способа доставки "Почта России". Исправлено.

[!] Multi-Vendor: Модули: Премодерация данных продавцов: Продавцу не показывалось предупреждение о процессе модерации при исправлении только описания продавца. Исправлено.

[!] Multi-Vendor: Модули: Премодерация данных продавцов: Страница массового редактирования товаров отображалась неправильно, когда модуль "Премодерация данных продавцов" был включен. Исправлено.

[!] Multi-Vendor: Модули: СДЭК: Продавцы видели сообщение "Доступ запрещён" на странице настроек способа доставки СДЭК. Исправлено.

[!] Multi-Vendor: Модули: Тарифные планы для продавцов: Выплата долгов продавцов: Промо-акции и скидки для корзины могли применяться на выплату долга продавца. Исправлено.

[!] Multi-Vendor: Модули: Тарифные планы для продавцов: Комиссия могла быть посчитана неправильно, если для основной валюты в магазине был задан знак для разделения тысячных частей числа. Исправлено.

[!] Multi-Vendor: Нижняя панель инструментов для администратора: Когда администратор переходил со страницы редактирования продавца в панель администратора продавца, случалась критическая ошибка. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Отложенные товары: Не работала кнопка добавления товара в отложенные товары у товарного предложения. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Когда администратор импортировал общий товар, создавался еще один общий товар. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Требуемые товары: Требуемые товары применялись только к главному товару, а не к предложениям продавцов. Исправлено.
