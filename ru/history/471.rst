*************
4.6.3 → 4.7.1
*************

==================================
Новая функциональность и улучшения
==================================

[+] Модули: Баннеры: Макеты: Добавлена возможность указывать позиции для баннеров в блоке.

[+] Модули: Баннеры: На список баннеров в панели администратора добавлены разбиение по страницам, сортировка и поиск.

[+] Модули: Вариации товаров: Добавлена возможность отображать все вариации товара на его странице на витрине в блоке "Товары".

[+] Модули: Почта России: Теперь список сервисов, которые модуль позволяет выбрать для способа доставки, зависит от вида отправления.

[+] Модули: Управление модулями: В режиме разработки добавлена возможность обновлять настройки и языковые переменные модулей без их переустановки.

[+] Панель администратора: На некоторые цифры, отображаемые в панели администратора, добавлены ссылки на статистику.

[+] Редактирование заказа: Покупатели: Добавлена функциональность сохранения изменённых данных в учетную запись пользователя при редактировании заказа в панели администратора.

[+] Товары: Добавлена возможность включить предзаказ для отдельных товаров, отсутствующих в наличии, даже при выключенной настройке "Разрешить отрицательное количество товаров в наличии".

[+] Товары: Расширенный поиск: Добавлены новые фильтры поиска по времени последнего редактирования и дате создания. Добавлен сохраненный поиск недавно обновленных товаров.

[+] Управление заказами: Выбор покупателя: В интерфейс создания нового заказа в панели администратора добавлена возможность найти нужного покупателя с помощью ввода части его электронного адреса или номера телефона.

[+] Управление заказами: Добавлена возможность создавать заказ без использования мыши (переключение между полями с помощью кнопки TAB).

[+] Управление заказами: При создании или редактировании заказа в панели администратора добавлен поиск товара по коду (или части кода, т.е. артикула).

[+] Хуки: Добавлен новый хук get_pages_after_sql.

[+] Хуки: Добавлены новые хуки delete_promotions_pre, delete_promotions_post, update_promotion_pre, update_promotion_post и get_promotions_post.

[+] Хуки: Добавлены новые хуки get_static_data_post и delete_static_data_pre.

[+] Хуки: Добавлены новые хуки для модификации налогов и доставки заказов (для добавления номеров заказа/покупателей или переопределения отображения данных о доставке) для счетов заказа.

[+] Ядро: Статусы: Реализована возможность перетаскивания статусов заказов, подарочных сертификатов и запросов на возврат, чтобы можно было менять порядок этих статусов.

=========================================
Изменения в существующей функциональности
=========================================

[*] Дизайн: WYSIWYG-редактор TinyMCE обновлен до версии 4.7.1.

[*] Импорт/Экспорт: Добавлена новая настройка, которая позволяет не импортировать новые товары, а только обновлять существующие.

[*] Импорт/Экспорт: Добавлено поле "Популярность" в список полей экспорта/импорта товаров.

[*] Импорт/Экспорт: Теперь на страницах импорта и экспорта рядом с названиями полей в CSV-файле отображаются переводы этих названий.

[*] Модули: CommerceML: Добавлена возможность создания вариаций товара при обмене с системами учета.

[*] Модули: YML экспорт: Обновлен список категорий товаров на Яндекс.Маркете.

[*] Модули: Видео-помощь: Встроенные видеоуроки по CS-Cart теперь на русском языке; также добавлены дополнительные видеоуроки.

[*] Модули: Вход через соцсети: Facebook: В интерфейс добавлена инструкция, как настроить ссылку для редиректа в приложении Facebook Login.

[*] Модули: Города: Изменено отображение автозаполнения городов, удалено дублирование, изменено отображение списка городов в панели администратора.

[*] Модули: Почта России: Службы доставки "Почта России (pochta.ru)" обновлена согласно документации (версия 1.8.7).

[*] Модули: СДЭК: Добавлена карта и возможность поиска ПВЗ СДЭК на странице оформления заказа.

[*] Модули: СДЭК: Добавлены всплывающие подсказки на страницу оформления отгрузки СДЭК.

[*] Модули: Служба доставки - СПСР-Экспресс: Устаревший модуль удален из новых дистрибутивов и помечен как устаревший в существующих магазинах.

[*] Опции товаров: Теперь у обязательных опций товаров по умолчанию не выбран один из вариантов, даже если товар настроен так, что опции выбираются одновременно, а не последовательно.

[*] Оформление заказа: Методы доставки: Строка "Бесплатная доставка" появляется рядом с методом доставки при оформлении заказа или при пересчете заказа только в том случае, если существует соответствующая языковая переменная.

[*] Управление заказами: Кнопки "Расширенный поиск" теперь находятся справа от полей поиска.

[*] Ядро: Фильтры товара: Функция fn_update_product_filter перемещена из app/controllers/backend/product_filters.php в app/functions/fn.catalog.php.

==================
Исправления ошибок
==================

[!] Email-уведомления: Товары: Цифровые товары: При покупке цифрового товара в уведомлении отображался список всех файлов товара, в том числе и выключенных. Исправлено.

[!] JS: Redactor 2: Не сохранялись HTML-комментарии. Из-за этого <!--CUT--> удалялся из статей, изменённых с помощью Redactor 2. Исправлено.

[!] Блоки: Узнать стоимость доставки: Блок не работал на детальной странице товара. Исправлено.

[!] Витрины: В режиме Simple Ultimate панель администратора могла переключиться в режим выбранной витрины, тем самым ограничив часть функциональности. Исправлено.

[!] Группы пользователей: Привилегии: Кнопка "Добавить пользователя" отображалась даже для тех администраторов, которые не могли создавать учётные записи других администраторов. Исправлено.

[!] Дизайн: Вкладки товара: Цвет вкладок в версиях для стационарных и мобильных устройств отличался. Исправлено.

[!] Дизайн: Макеты: Добавление блока с шаблоном "Узнать стоимость доставки" на страницу макета по умолчанию ломало расчет стоимости доставки на странице корзины. Исправлено.

[!] Дизайн: Тема Responsive: Товары: Нижняя часть цены товара была обрезана в блоке с шаблоном "Скроллер". Исправлено.

[!] Дизайн: Уведомления: На мобильных устройствах некорректно отображались уведомления. Исправлено.

[!] Дизайн: Языки с письмом справа налево: Исправлено неправильное отображение символов и кнопок.

[!] Дизайн: Языки с письмом справа налево: Исправлены многочисленные ошибки, связанные с письмом справа налево.

[!] Дизайн: Языки с письмом справа налево: Улучшено отображение динамических элементов (всплывающих подсказок, меню, и т.д.).

[!] Заказы: Опции товаров: При выборе другого языка не изменялся язык опций в заказе. Исправлено.

[!] Категории: При редактировании товара на витрине, для которой он только доступен, но не принадлежит, нельзя было добавить товару новые категории. Исправлено.

[!] Модули: CommerceML: При загрузке товаров из систем учета, новые товары не создавались, если в файле были характеристики. Исправлено.

[!] Модули: Searchanise: Некоторые SQL-запросы не соответствовали правилам написания кода CS-Cart. Исправлено.

[!] Модули: Бонусные баллы: Управление заказами: Если бонусные баллы применялись к заказу в панели администратора, то скидка от бонусных баллов умножалась на количество экземпляров товара в заказе. Исправлено.

[!] Модули: Вариации товаров: Если покупатель выбирал другую опцию у товара с вариациями, то на странице товара пропадали вкладки "Прикреплённые файлы" и "Комбинации товаров". Исправлено.

[!] Модули: Вариации товаров: Отображаемые данные товара не изменялись, если покупатель выбирал другую опцию у товара с вариациями, который отображался в блоке "Товары". Исправлено.

[!] Модули: Возврат товаров: В email-уведомлениях о возврате отображался номер (ID) причины возврата, а не сама причина. Исправлено.

[!] Модули: Вход через соцсети: Вход через социальные сети не работал во встроенном браузере мобильного приложения Facebook. Исправлено.

[!] Модули: Вход через соцсети: Для входа на сайт через Facebook запрашивались лишние разрешения от приложения. Исправлено.

[!] Модули: Обратный звонок: При выборе языка с письмом справа налево Некорректно отображался номер телефона в блоке "Обратный звонок". Исправлено.

[!] Модули: Отзывы и комментарии: Была уязвимость, позволяющая редактировать комментарии и отзывы других пользователей. Исправлено.

[!] Модули: Отзывы и комментарии: Рейтинги товара на странице товара и на странице категории в некоторых случаях могли быть разными. Исправлено.

[!] Модули: Платежи через PayPal: Налог на добавочный сбор вычислялся неверно после обработки уведомления о проведении платежа. Исправлено.

[!] Модули: Платежи через PayPal: Страница Express Checkout не отображалась на выбранном покупателем языке. Исправлено.

[!] Модули: Российские способы оплаты: Если метод оплаты PayAnyWay был доступен для нескольких витрин, уведомления о поступлении платежа не обрабатывались для всех витрин, кроме той, адрес которой задан на стороне платежной системы. Исправлено.

[!] Модули: Российские способы оплаты: Сбербанк: Некоторые обязательные параметры не передавались в QR-код для чека. Исправлено.

[!] Модули: Российские способы оплаты: Яндекс.Деньги: Использовался неверный код ответа при несоответствии суммы заказа. Исправлено.

[!] Модули: СДЭК: При оформлении заказа неверно передавался вес товаров в СДЭК. Исправлено.

[!] Модули: Социальные кнопки: В URL у og-тегов всегда был HTTP вместо HTTPS. Исправлено.

[!] Модули: Яндекс.Доставка: При указании адреса с дополнительными значениями, при оформлении заказа возникали ошибки PHP Notice. Исправлено.

[!] Модули: Яндекс.Метрика: Не работала передача имени товара при размещении заказа. Исправлено.

[!] Настройки: Часовые пояса: Неверное время показывалось для часового пояса “Фиджи, Камчатка, Маршалловы о.”. Исправлено.

[!] Опции товаров: При создании или удалении глобальной опции возникало сообщение об ошибке. Исправлено.

[!] Оформление заказа: Способы оплаты: Кредитная карта (cc.tpl): На устройствах с Android в браузере Chrome у пользователей возникали проблемы при вводе реквизитов кредитной карты. Исправлено.

[!] Панель администратора: Паджинация: Количество отображаемых объектов было смещено относительно общего количества объектов. Исправлено.

[!] Страны: Включение или выключение одной страны также включало или выключало остальные страны. Исправлено.

[!] Товары: Расширенный поиск: При поиске с фильтром по заказам, колонки "Приобретенное кол-во" и "Предварительная стоимость" в результатах поиска отображали неверные значения для товаров с комбинациями опций. Исправлено.

[!] Управление заказами: Выпадающий список с предположениями у строки поиска покупателя при создании заказа был слишком широким. Исправлено.

[!] Управление заказами: Сообщения об ошибках при создании заказа в панели администрирования не выделялись красным цветом. Исправлено.

[!] Экспорт/Импорт: Товары: Информация о формате импорта характеристик и опций в подсказке на странице импорта товаров была неверной. Исправлено.

[!] Ядро: JS: При открытии страницы редактирования товара в окне консоли появлялась 404 ошибка. Исправлено.

[!] Ядро: Кэш: Если было несколько витрин, а кэш инициализировался до инициализации company_id, то на всех витринах использовались одни и те же данные из кэша. Исправлено; теперь, если кэш инициализируется до того, как на витрине инициализируется company_id, то выдаётся DeveloperException.

[!] Ядро: Пользователи: В функции fn_get_user_short_info неправильно формировался SQL-запрос. Исправлено.

[!] {#6751} Модули: Отложенные товары: При попытке открыть товар в режиме "Редактирование дизайна витрины" открывалось окно с 404 ошибкой. Исправлено.

[!] {#6960} Тема Bright: Макеты: Блоки: Товары: Настройка "Показывать цену" у шаблона "Скроллер" не работала. Исправлено.

[!] {#6975} Модули: Опросы: Сохранение страницы "Опрос" с любым статусом отличным от "Активно" приводило к тому, что данные с вкладки "опрос" не отображались. Исправлено.

[!] {#6996} {#7006} Дизайн: Языки с письмом справа налево: Прокрутка баннеров, товаров и изображений работала неправильно. Исправлено.

[!] {#7001} Товары: Характеристики: Если у товара была характеристика с типом "Флажок: Несколько" и несколькими вариантами, то в списке сравнения для данного товара отображался только один вариант. Исправлено.

[!] {#7007} JS: Redactor 2: На витрине не работало выравнивание текста, если для его редактирования использовался Redactor II. Исправлено.

[!] {#7041} Модули: Комбинации товаров: Скидка на комбинацию товаров не учитывалась, когда проверялось, подпадает ли заказ под условия промо-акции для корзины. Исправлено.
