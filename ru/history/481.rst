*****
4.8.1
*****

==================================
Новая функциональность и улучшения
==================================

[+] Дизайн: Заказы: На страницу заказа на витрине добавлены иконки товаров.

[+] Модули: Вариации товаров (Beta): Добавлена возможность выбора вариации, которую нужно показывать покупателям по умолчанию.

[+] Модули: Подтверждение на обработку персональных данных (152-ФЗ): Добавлена возможность запрашивать активное согласие на обработку персональных данных.

[+] Модули: Расширенный импорт товаров (Beta): Добавлена возможность импорта значений из XML-документов с неплоской структурой.

[+] Модули: Расширенный импорт товаров (Beta): На форму редактирования пресетов импорта добавлена проверка корректности модификаторов.

[+] Модули: Соответствие GDPR: Добавлен новый блок с кнопками, с помощью которых покупатели могут запросить свои персональные данные или анонимизацию.

[+] Резервное копирование и восстановление: В список резервных копий добавлена сортировка по дате.

[+] Способы оплаты: Deltapay, Ingenico: Добавлена проверка валидности данных платежа при обработке ответа от платежной системы.

[+] Товары: Изображения: В панель администратора добавлена возможность легко загружать несколько изображений для товара с помощью перетаскивания.

[+] Управление товарами: Категории: На страницу редактирования товара добавлена возможность искать и добавлять товару категории с помощью ввода части названия категории.

=========================================
Изменения в существующей функциональности
=========================================

[*] Адаптивная панель администратора теперь включена по умолчанию; старая панель администратора доступна в виде модуля.

[*] Адаптивная панель администратора: Для верхней панели была добавлена тень.

[*] Глобальные опции: В панель администратора добавлено новое поле для внутреннего имени опции и возможность сортировки по имени опции.

[*] Добавлена обратная совместимость с PHP < 5.5.0.

[*] Документы: Счёт: Переменная "p.product_options" переименована в "p.raw.options".

[*] Модули: Searchanise: Модуль Searchanise теперь совместим с модулем "Ограничение по возрасту".

[*] Модули: YML экспорт: Модуль переименован в "Экспорт в Яндекс.Маркет".

[*] Модули: Вариации товаров (Beta): Теперь оптовые цены и параметры доставки родительского товара применяются к вариациям.

[*] Модули: Вход через соц. сети: Обновлена библиотека авторизации через социальные сети.

[*] Модули: Города: Добавлены регионы для Казахстана, Киргизии, Белоруссии, Армении, Украины.

[*] Модули: Обратный звонок: Добавлена привязка передаваемых масок ввода телефона к списку включенных стран в магазине.

[*] Модули: Платежи через PayPal: Перерасчёт корзины теперь не происходит при обработке IPN (уведомления от PayPal о платеже).

[*] Модули: Почта России: EMS: Служба доставки EMS заменена на службу доставки "Почта России".

[*] Модули: Расширенный импорт товаров (Beta): Теперь модуль включен по умолчанию.

[*] Модули: Соответствие GDPR: Из настроек модуля убраны поля для ввода электронного адреса и названия компании; теперь эти значения берутся у соответствующих витрин.

[*] Модули: Соответствие GDPR: Настройка "Оповещать посетителей об использовании кук" перемещена из раздела "Настройки → Настройки безопасности" в модуль GDPR; также добавлена возможность запрашивать у пользователей активное согласие на использование кук, прежде чем они войдут на сайт.

[*] Модули: Экспорт в Яндекс.Маркет: Добавлена возможность выгрузки желаемой категории для товара.

[*] Модули: Яндекс.Маркет: Модуль удалён в связи с закрытием программы "Заказ на Маркете".

[*] Незавершенные покупки: Теперь незавершенные покупки по умолчанию отсортированы по дате.

[*] Опции: Теперь галочку "Расчёт кол-ва товаров в наличии" можно поставить уже при создании опции.

[*] Способы доставки: USPS: Сервисы "First Class Mail International Large Envelope" и "First Class Mail International Letter/Postcard" больше не поддерживаются и были заменены на "USPS First-Class Package International Service".

[*] Способы оплаты: Amazon Checkout: Удалён устаревший способ оплаты.

[*] Способы оплаты: ProxyPay3: Удалён устаревший способ оплаты.

[*] Способы оплаты: WorldPay: Добавлены текущие поддерживаемые валюты для способа оплаты.

[*] Товары: Максимальная длина кода товара увеличена до 64 символов.

[*] Установщик: Добавлено уведомление о рекомендуемой библиотеке для работы с изображениями.

[*] Файлы: Функция "Размер изображения" присутствовала в контекстом меню файлового менеджера, но не работала. Пункт меню удален.

==================
Исправления ошибок
==================

[!] Адаптивная панель администратора: Видео-помощь: При включенном модуле "Видео-помощь" панель администратора неправильно отображалась в IE11. Исправлено.

[!] Адаптивная панель администратора: Дизайн: Макеты: Иконки блоков при их добавлении на странице редактирования макета отображались неправильно. Исправлено.

[!] Адаптивная панель администратора: Расширенный поиск не работал в браузере Safari. Исправлено.

[!] Адаптивная панель администратора: Редактирование заказа: Ширина поля для ввода имени товара не изменялась при повороте мобильного устройства на 90 градусов и смене ориентации страницы. Исправлено.

[!] Адаптивная панель администратора: Товары: При массовом редактировании ширина панели инструментов была неправильной. Исправлено.

[!] Адаптивная панель администратора: Товары: При нажатии на товар не отображалось контекстное меню. Исправлено.

[!] Детектор изменений файлов ядра: После редактирования или удаления файла robots.txt возникало уведомление об изменениях файлов ядра. Исправлено.

[!] Адаптивная панель администратора: Форма входа в панель администратора была расположена в верхней части страницы.

[!] Модули: CommerceML: Если несколько раз импортировать товары с вариациями, то у всех вариаций было одинаковое значение 'variation_options'. Исправлено.

[!] Модули: Pickpoint: На странице оформления неверно отображалась дата доставки. Исправлено.

[!] Модули: Searchanise: Удаление языка по умолчанию или вендора приводило к удалению из магазина ключей для доступа к Searchanise. Исправлено.

[!] Модули: Бонусные баллы: При редактировании контента сайта были ошибки, если в корзине была комбинация товара и пользователь был авторизован. Исправлено.

[!] Модули: Вариации товаров (Beta): REST API: Вариацию товара невозможно было создать через API. Исправлено.

[!] Модули: Вариации товаров (Beta): Вариант опции, используемый в вариации, мог быть отключен или удален. Исправлено.

[!] Модули: Вариации товаров (Beta): Неверно рассчитывалось количество товаров в коробке, если в заказе было несколько вариаций одного товара. Исправлено.

[!] Модули: Вариации товаров (Beta): При редактировании заказа администратором не работало добавление вариаций через расширенный поиск. Исправлено.

[!] Модули: Вариации товаров (Beta): Сохранённый поиск по настраиваемым товарам также выдавал в результатах поиска простые товары. Исправлено.

[!] Модули: Вариации товаров (Beta): У опций товаров на странице оформления заказа был слишком большой отступ. Исправлено.

[!] Модули: Платежи через PayPal: Когда модуль был выключен, на страницах редактирования способов оплаты PayPal возникала критическая ошибка. Исправлено.

[!] Модули: Подтверждение на обработку персональных данных (152-ФЗ): Модуль не использовался на формах от модуля "Обратный звонок" и способа оплаты "Выставить счёт". Исправлено.

[!] Модули: Рассылки: Если галки подписки на рассылку не отображались при оформлении заказа, то после оформления заказа у пользователя сбрасывалась подписка. Исправлено.

[!] Модули: Расширенный импорт товаров (Beta): Изображения товаров не импортировались по ссылке, если поле со ссылкой содержало перенос строки. Исправлено.

[!] Опции: Изображения: При выборе опции на странице товара эта страница могла прокрутиться вниз. Исправлено.

[!] Опции: Управление заказами: Выключенная опция типа "Флажок" могла отображаться в деталях заказа. Исправлено.

[!] Пользователи: Администраторы: Даже если у администратора не была задана группа, ему не отображалась кнопка создания новых администраторов. Исправлено.

[!] Способы доставки: Администратору магазина не приходило уведомление о способах доставки, у которых происходили ошибки в процессе расчета. Исправлено.

[!] Товары: Общие товары для разных витрин: Товар, сделанный общим для нескольких витрин, считался общим, даже если все витрины, кроме одной, затем были удалены. Исправлено.

[!] Товары: Характеристики: Если товар принадлежал к двум категориям, и для дополнительной категории была доступна характеристика, то при назначении этой характеристике новых категорий сбрасывалось значение характеристики у товара. Исправлено.

[!] Файловый менеджер: Файлы с запрещенными расширениями могли быть созданы через файловый менеджер. Исправлено.

[!] Характеристики товаров: Варианты отключенной характеристики всё равно отображались на витрине. Исправлено.

[!] Экспорт/Импорт: Для товара не определялась главная категория, если в загружаемом файле в полях 'Category' и 'Secondary categories' была задана одинаковая категория. Исправлено.

[!] Ядро: База данных: В случае разрыва соединения с БД, повторное выполнение SQL-запроса, для объектов, которые могут относиться к нескольким витринам, завершалось ошибкой. Исправлено.

[!] {#7213} Адаптивная панель администратора: Выбора даты неправильно отображался во всплывающих окнах. Исправлено.

[!] {#7230} Database: MySQL8: В SQL-запросах использовались ключевые слова, которые впервые были зарезервированы в MySQL8. Исправлено.

[!] {#7239} REST API: Сущность Orders: При редактировании заказа у него сбрасывался "parent_order_id". Исправлено.
