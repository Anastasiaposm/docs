******
4.10.4
******

==================================
Новая функциональность и улучшения
==================================

[+] Модули: Вариации товаров: В блок "Список вариантов товара" добавлена сортировка.

[+] Модули: Вариации товаров: В форму создания вариаций был добавлен поиск по характеристикам.

[+] Модули: RetailCRM (Beta): Добавлена возможность выгружать надбавку к способу оплаты как отдельный товар.

=========================================
Изменения в существующей функциональности
=========================================

[*] Модули: Вариации товаров: Добавлена возможность редактировать артикулы товаров на вкладке "Вариации".

[*] Модули: Комбинации товаров: Добавлен индекс в таблицу "buy_together" для ускорения обработки запросов.

[*] Модули: Платежи через PayPal: PayPal Pro переименован в Website Payments Pro.

[*] Модули: SEO: Добавлена поддержка новых элементов микроразметки SEO (review, brand, aggregateRating, url).

[*] Настройки: Введённый пароль от SMTP теперь скрыт звёздочками.

[*] Способы оплаты: SagePay Direct: Добавлена поддержка 3-D Secure 2.

[*] Уведомления: Уведомление о проблемах при загрузке файлов было обновлено.

[*] Multi-Vendor: Модули: Тарифные планы для продавцов: Вариации товаров: Теперь дочерние товары не будут влиять на ограничение плана по количеству товаров.

[*] Multi-Vendor: Модули: Тарифные планы для продавцов: Некоторые хуки были обновлены.

[*] Multi-Vendor Plus: Модули: Общие товары для продавцов (Beta): Колонка "Рекомендованная цена" была добавлена на список товаров в панели администратора.

==================
Исправления ошибок
==================

[!] Виджет: Магазин не работал в режиме виджета. Исправлено.

[!] Дизайн: Класс cm-scroll не работал во всплывающих окнах на телефонах. Исправлено.

[!] Дизайн: Макеты: Блоки нельзя было удалить после добавления в сетку без перезагрузки страницы макета. Исправлено.

[!] Дизайн: Местоположение пользователя: В шапке сайта выбранный город мог находиться на другой строке. Исправлено.

[!] Дизайн: Темы: Responsive: Кнопка применения подарочного сертификата в стиле Brightness отображалась некорректно. Исправлено.

[!] Дизайн: Товары: При быстрой прокрутке изображений на странице товара на витрине появлялась пустая область под подвалом страницы. Исправлено.

[!] Заказы: Налоги: Налог добавлялся к заказу пользователя, освобождённого от налогов. Исправлено.

[!] Заказы: Отчеты о продажах: Информация о предоставленных скидках могла быть неполной. Исправлено.

[!] Категории: Дерево категорий в некоторых случаях некорректно отображалось в боковой панели на детальной странице категории. Исправлено.

[!] Категории: При удалении категории всегда показывалось уведомление об успешном удалении категорий, каким бы ни был результат выполнения функции. Исправлено.

[!] Корзина: Товары: Не всегда удавалось изменить кол-во у заказываемого товара, если для него было задано минимальное количество заказа. Исправлено.

[!] Меню: При клонировании меню в некоторых случаях терялась зависимость элемента от родительского элемента. Исправлено.

[!] Модули: АТОЛ Онлайн: Если валют было много, то чек мог создаться с некорректной валютой. Исправлено.

[!] Модули: АТОЛ Онлайн: Неверно формировалась сумма налога для товара в чеке возврата, если в заказе было куплено больше 1 экземпляра товара. Исправлено.

[!] Модули: Бонусные баллы: Настройка "Заменить глобальный курс конвертации баллов" была недоступна на странице добавления нового товара. Исправлено.

[!] Модули: Вариации товара: Не срабатывало автоматическое изменение главного товара после импорта. Исправлено.

[!] Модули: Вариации товаров: Количество товаров в категории было неверным, если категория вариации была изменена путем массового редактирования. Исправлено.

[!] Модули: Вариации товаров: Не сохранялись некоторые параметры доставки дочерних товаров. Исправлено.

[!] Модули: Вариации товаров: Счетчик количества товаров в быстрой навигации по товарам (предыдущий, следующий) отображался неправильно после переключения между вариациями. Исправлено.

[!] Модули: Вариации товаров: Форма генерации новых вариаций не открывалась, когда было слишком много возможных вариаций. Исправлено; теперь форма откроется, но предложит администраторам создать вариации вручную или через импорт, а затем привязать к группе.

[!] Модули: Вариации товаров: Языковые переменные для основного языка в некоторых случаях могли не устанавливаться. Исправлено.

[!] Модули: Возврат товаров: Платежи через PayPal: При выполнении возврата нескольких товаров возвращалась только стоимость первого товара. Исправлено.

[!] Модули: Зависимости для способов оплаты: Снова оплатить заказ: На странице заказа были доступны способы оплаты, запрещенные для выбранного способа доставки. Исправлено.

[!] Модули: Карты и геолокация: На странице товара в разделе оценки стоимости доставки отображался плейсхолдер “shipping”. Исправлено.

[!] Модули: Купи В Кредит: Отсутствовал параметр 'showcaseID' в настройках способа оплаты. Исправлено.

[!] Модули: Магазины и пункты самовывоза: Город пункта самовывоза зависел от языка в витрине; из-за этого в некоторых случаях не находились пункты самовывоза. Исправлено.

[!] Модули: Магазины и пункты самовывоза: Если в городе покупателя не было точек самовывоза, то отображалась пустая страница. Исправлено.

[!] Модули: Магазины и пункты самовывоза: Использование списка городов вместо карты в окне выбора города вызывало ошибки JavaScript. Исправлено.

[!] Модули: Магазины и пункты самовывоза: СДЭК: Предварительная стоимость доставки не включала наценку к стоимости. Исправлено.

[!] Модули: Магазины и пункты самовывоза: Список городов на странице с картой пунктов самовывоза отображал города без привязки к витрине. Исправлено.

[!] Модули: Общие товары для продавцов (Beta): Общий товар показывается на списке "Товары в продаже" после выполнения поиска. Исправлено.

[!] Модули: Отзывы и комментарии: В некоторых случаях невозможно было добавить отзывы о компании через панель администратора. Исправлено.

[!] Модули: Отзывы и комментарии: Устаревшая секция "События" присутствовала в настройках модуля. Исправлено.

[!] Модули: Платежи через PayPal: PayPal Pro: Настройки 3-D Secure были обязательными для заполнения. Исправлено.

[!] Модули: Подарочные сертификаты: Email-уведомление о смене статуса сертификата приходило на языке, выбранном по умолчанию для панели администратора вместо языка, установленного у покупателя. Исправлено.

[!] Модули: Почта России: Города: Стандартные почтовые индексы городов Севастополь, Магас и Грозный не поддерживали доставку Почтой России. Исправлено.

[!] Модули: Почта России: На бланк формы вместе с номером телефона попадали некоторые специальные символы из номера, из-за чего не хватало места для всех цифр. Исправлено.

[!] Модули: Прайс-листы: В настройках не отображался выбранный пункт в выпадающем списке. Исправлено.

[!] Модули: Прайс-листы: Прайс-лист для Google Base: Поле "Sale price" не выгружалось по CRON. Исправлено.

[!] Модули: Рассылки: Подтверждение на обработку персональных данных (152-ФЗ): Ссылка на условия политики конфиденциальности показывалась в блоке подписки несколько раз при нажатии на кнопку "Подписаться". Исправлено.

[!] Модули: Расширенный импорт товаров: Вариации товаров: При импорте могла выбираться некорректная группа вариаций. Исправлено.

[!] Модули: Российские способы оплаты: Робокасса: Список способов оплаты на странице настроек способа оплаты Robokassa был пустым. Исправлено.

[!] Модули: Российские способы оплаты: Не осуществлялся возврат через платежную систему Авангард. Исправлено.

[!] Модули: Российские способы оплаты: Сбербанк: Некоторые обязательные параметры не передавались в QR-код для чека. Исправлено.

[!] Модули: СДЭК: У города Химки были неверные коды, поэтому отображались не все доступные ПВЗ. Исправлено.

[!] Модули: Чат с продавцом: В некоторых случаях продавец не видел сообщений. Исправлено.

[!] Модули: Яндекс.Метрика: Передаваемое количество посещений страниц могло быть больше реального значения. Исправлено.

[!] Модули: Boxberry: Города: Курьерская доставка не отображалась для некоторых городов. Исправлено.

[!] Модули: Boxberry: На странице оформления заказа не менялся адрес пункта выдачи при выборе другого пункта. Исправлено.

[!] Модули: CommerceML: Бонусные баллы не начислялись покупателю, если статус заказа был изменен в процессе синхронизации. Исправлено.

[!] Модули: CommerceML: Если в поле кода товара использовался артикул, то у созданных вариаций артикул не был заполнен. Исправлено.

[!] Модули: CommerceML: Если у товаров был combination ID, но не было значений для характеристик, то при повторной выгрузке они выгружались как отдельные, хотя не должны были выгружаться вообще. Исправлено.

[!] Модули: CommerceML: При выборе загрузки только обновленных товаров и наличии в выгрузке вариаций товаров могла возникать ошибка. Исправлено.

[!] Модули: SEO: Генерировались неправильные прямые ссылки на скрипты некоторых платежных процессоров при включении настройки "Отображать язык в URL". Исправлено.

[!] Модули: SEO: Новые SEO-имена создавались с постфиксом, несмотря на включенную настройку "Использовать один и тот же URL для всех языков". Исправлено.

[!] Модули: Unisender: Не отправлялось SMS-сообщение при смене статуса отгрузки. Исправлено.

[!] Настройки: Электронная почта: Некоторые письма не отправлялись при работе с панелью администрирования в режиме "Все магазины". Исправлено.

[!] Незавершенные покупки: Информация о покупателе не сохранялась, даже если была введена. Исправлено.

[!] Оформление заказа: В случае если значение настройки "Порядок отображения адресов на странице профиля"(устаревшая) было установлено в "Сначала адрес плательщика", то после перехода на одностраничное оформление заказа местоположение покупателя сбрасывалось в значение по умолчанию. Исправлено.

[!] Оформление заказа: Город со специальным символом в названии не мог быть найден. Исправлено.

[!] Оформление заказа: Маски телефонов: Не поддерживался формат телефонных номеров Малайзии. Исправлено.

[!] Оформление заказа: Поля профиля: Адрес демо-покупателя не менялся после первого заказа. Исправлено.

[!] Оформление заказа: Список способов доставки на странице оформления заказа не обновлялся при редактировании способов доставки. Исправлено.

[!] Оформление заказа: Способы оплаты: Первый способ оплаты не всегда выбирался по умолчанию на странице оформления заказа. Исправлено.

[!] Панель администратора: Некоторые страницы были не адаптированы под мобильные устройства. Исправлено.

[!] Панель администратора: Редактирование товара: При сохранении изменений содержимое страницы могло мигать. Исправлено.

[!] Пользователи: API-доступ автоматически активировался при редактировании профиля пользователя в админке, не зависимо от настройки "Доступ к API для этого пользователя". Исправлено.

[!] Способы доставки: При смене языка контента в панели администратора не менялись названия способов доставки. Исправлено.

[!] Способы доставки: При удалении языковой переменной "free" (чтобы не показывать "Бесплатно" рядом со способом доставки) не удалялось тире. Исправлено.

[!] Способы оплаты: QB Merchant Service: При размещении заказа возникала ошибка PHP Notice. Исправлено.

[!] Тарифные зоны: Город с названием длиннее 36 символов некорректно сохранялся. Исправлено.

[!] Товары: Большая картинка: Независимо от того, на какое изображение вы нажимали, открывался предпросмотр первой картинки. Исправлено.

[!] Товары: Изображения, загружаемые для товара, в некоторых случаях могли заменять друг друга. Исправлено.

[!] Товары: Опции: Мультивитринность: Варианты локальной опции удалялись после того, как товар редактировался с витрины, для которой он был сделан доступным. Исправлено.

[!] Товары: При установке определенных значений шага списка выбора количества могла произойти ошибка при сохранении товара. Исправлено.

[!] Характеристики: Не сохранялись параметры сортировки на детальной странице характеристик. Исправлено.

[!] Шаблоны email-уведомлений: Имя, фамилия и номер телефона покупателя не отображались в письмах по умолчанию. Исправлено.

[!] Экспорт/Импорт: Характеристики: При импорте характеристик очищались категории и группы. Исправлено.

[!] Экспорт/Импорт: Характеристики: При экспорте и импорте характеристик не экспортировались и импортировались некоторые обязательные поля (Purpose, Feature type, Filter style). Исправлено.

[!] Ядро: Если реальный домен отличался от домена текущего запроса, то терялись GET-параметры при редиректе на реальный домен. Исправлено.

[!] JS: WYSIWYG: Redactor: Всплывающие окна вставки ссылки находилось под редактором. Исправлено.

[!] Multi-Vendor: Модули: Возврат товаров: Сумма заказа вычиталась на странице "Бухгалтерский учёт" при любом статусе возврата. Исправлено.

[!] Multi-Vendor: Модули: Премодерация данных продавцов: Выпадающий список выбора продавца обрезался на странице утверждения товаров. Исправлено.

[!] Multi-Vendor: Модули: Тарифные планы для продавцов: Символ валюты отображался с HTML-кодом во всплывающем окне редактирования тарифного плана. Исправлено.

[!] Multi-Vendor: Продавцы: Ссылка "Приглашения, ожидающие ответа" ошибочно отображалась для продавцов. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов (Beta): Вариации общего товара не показывались на странице управления вариациями в панели администратора. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов (Beta): В быстром просмотре товаров отображалась кнопка "Добавить в корзину" вместо кнопки, ведущей на все предложения. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов (Beta): Общие товары дублировались, когда их экспортировали и импортировали обратно. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов (Beta): Общие товары не отображались в магазинах продавцов. Исправлено.

[!] Multi-Vendor Plus: Модули: Оплата напрямую продавцам: Промо-акции и скидки: Продавец не мог выбрать опцию у товара при создании промо-акции. Исправлено.

===========
Сервис-паки
===========

----------
4.10.4.SP1
----------

[!] Исправлена проблема со способами оплаты Stripe и Stripe Connect, актуальными только для международной версии.

----------
4.10.4.SP2
----------

[[!] Дизайн: Меню: На витрине не работал второй уровень меню (подкатегории) на iOS 13. Исправлено.
