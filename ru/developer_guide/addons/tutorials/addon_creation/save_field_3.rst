*****************************************
13. Сохранение данных настройки. Часть 3. 
*****************************************

В прошлом уроке:

1.  Нашли запросы к базе данных, которые сохраняют и обновляют товар.

2.  Выяснили, что нужно создать новую колонку в базе данных, чтобы сохранить данные из новой настройки.

Очень часто модулям необходимо создавать свои таблицы базы данных или отдельные колонки в существующих таблицах MySQL. Каждый модуль в CS-Cart может выполнять запросы к базе данных при установке или удалении модуля. 

Создадим новую колонку с помощью модуля «Мой первый модуль». 

1.  Откройте файл **addon.xml** модуля:

    ``app/addons/first_addon/addon.xml``

2.  Запросы к базе данных выполняются с помощью секции ``<queries>`` в xml схеме модуля.

    В данной секции вы можете перечислить запросы к MySQL которые будут выполнены при:

    .. list-table::
        :widths: 10 30

        *   -   Установка модуля

            -   ``<item><!-- Запрос --></item>``

        *   -   Удаление модуля
        
            -   ``<item for="uninstall"><!-- Запрос --></item>``

3.  В нашем случае, необходимо создать колонку **video** в таблице **cscart_products**.

    Добавим следующий код в **addon.xml**:

    .. literalinclude:: files/addon_queries_1.xml
        :language: xml

    При установке модуля колонка будет создана, при удалении модуля удалена.

    .. note::

        Все запросы выполняются только при переустановке модуля в панели администратора. 
        Все запросы проходят предварительную обработку в платформе. 
        Модуль не установится, если запрос содержит ошибки.

4.  В результате у нас получается такой файл **addon.xml** модуля «Мой первый модуль»:

    .. literalinclude:: files/addon_queries_2.xml
        :language: xml
        :linenos:

5.  Переустановите модуль в панели администратора. 

6.  Откройте phpmyadmin и проверьте создание новой колонки:

    .. fancybox:: img/howto_addon_32.png
        :alt: Первый модуль

    Отлично! Колонка создалась. 

7.  Проверим, сохраняются ли данные из настройки "Код от видео с YouTube" на странице редактирования товара.

    Вводим: 123456789

    Нажимаем Сохранить. Данные сохранились и остались в ячейке.

    .. fancybox:: img/howto_addon_33.png
        :alt: Первый модуль

8.  Проверяем ещё раз в phpmyadmin. 

    .. fancybox:: img/howto_addon_34.png
        :alt: Первый модуль

    Также, вы можете удалить модуль в панели администратора. Колонка будет удалена, данные будут потеряны.

Ну вот и все. Настройка работает, данные сохраняются. Вы уже можете использовать информацию из настройки в любом месте витрины интернет-магазина.

По теме создания настройки и сохранения данных из неё остался один не раскрытый вопрос: "Почему данные из базы MySQL сразу отображаются в соответствующих полях и настройках панели администратора." Рассмотрим, это в следующем уроке.

