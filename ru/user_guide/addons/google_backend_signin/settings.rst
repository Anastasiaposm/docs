*******************************************************
Как настроить вход в панель администратора через Google
*******************************************************

.. note::

    Эта функциональность впервые появилась в CS-Cart и Multi-Vendor 4.9.1. В Multi-Vendor она никак не влияет на продавцов и затрагивает только администраторов самого магазина.

Чтобы администраторы могли заходить в панель администратора через свои учётные записи в Google и без пароля, понадобится настроить проект на Google Cloud и привязать его к магазину через модуль. В статье описано, как это сделать.

=========================
Шаг 1. Настраиваем модуль
=========================

#. Откройте страницу **Модули → Управление модулями** в панели администратора магазина.

#. Перейдите на вкладку **Просмотреть все доступные модули**.

#. Установите модуль **Вход в панель администратора через Google**.

#. Нажмите на название модуля, чтобы открыть его настройки. Там понадобится сделать две вещи:

   * Взять разрешенные URI перенаправления из настроек модуля и перенести их в свой проект на Google Cloud.

   * Заполнить 2 поля в настройках модуля данными из вашего проекта в Google Cloud (о том, как создать проект, читайте в шаге 2):

     * идентификатор клиента;

     * секрет клиента.

   .. fancybox:: img/google_backend_signin_addon.png
       :alt: Настройки модуля "Вход в панель администратора через Google".

========================================
Шаг 2. Настраиваем проект в Google Cloud
========================================

#. Откройте раздел `"Управление ресурсами" <https://console.cloud.google.com/cloud-resource-manager>`_ в Google Cloud.

#. Нажмите **СОЗДАТЬ ПРОЕКТ**.

   .. fancybox:: img/google_cloud_create_project.png
       :alt: Создание проекта в Google Cloud.

#. Введите любое название (например, можно использовать название вашей компании) и создайте проект.

#. Перейдите на `страницу создания учётных данных <https://console.cloud.google.com/apis/credentials>`_. Убедитесь, что в правой верхней части страницы выбран проект, который вы только что создали.

#. Нажмите **Создать учётные данные** и выберите *Идентификатор клиента OAuth*.

#. Сначала Google предложит вам настроить **Окно доступа OAuth**. Согласитесь, и вы попадёте на страницу настроек. Их там много, но заполнить нужно только несколько:

   * **Название приложения** — можете ввести название вашей компании;

   * **Авторизованные домены** — введите домен вашего магазина.

   .. fancybox:: img/google_oauth_consent_screen.png
       :alt: Настройка окна доступа OAuth в Google Cloud.

#. Нажмите **Сохранить**, и вы автоматически вернётесь на страницу настройки учётных данных. Задайте такие настройки:

   * **Тип приложения** — выберите *Веб-приложение*;

   * **Название** — используйте значение по умолчанию или введите любое другое имя;

   * **Разрешенные URI перенаправления** — возьмите значение из аналогичной настройки в модуле **Вход в панель администратора через Google** в CS-Cart.

   .. important::

       Перед сохранением убедитесь, что Google принял ваш URI: строка ввода стала пустой, а введённый ранее URI отображается рядом с ней. Это может произойти не сразу; попробуйте перейти на другое поле и вернуться в **Разрешенные URI перенаправления**.

   .. fancybox:: img/google_cloud_oauth.png
       :alt: Создание учётных данных для проекта в Google Cloud.

   После того, как вы создадите учётные данные, вы увидите *Идентификатор клиента* и *Секрет клиента* от вашего проекта. Скопируйте их и вставьте в настройки модуля **Вход в панель администратора через Google**. Пока не сохраняйте настройки модуля и не закрывайте их.

   .. important::

       Когда будете заполнять эти настройки, проверьте, чтобы в начале и в конце не было лишних пробелов. Они могли добавиться при копировании

#. В другой вкладке или окне браузера вернитесь в `панель управления Google Cloud <https://console.cloud.google.com/apis/dashboard>`_.

#. Нажмите **ВКЛЮЧИТЬ API И СЕРВИСЫ**, найдите раздел **Social**, нажмите на **Google+ API** и выберите **Включить**.

   .. fancybox:: img/google_cloud_dashboard.png
       :alt: Панель управления Google Cloud.

#. Теперь в настройках модуля **Вход в панель администратора через Google** нажмите **Сохранить и проверить вход**.

   * Если всё настроено правильно, то появится окно с выбором электронного адреса. Вы сможете проверить, работает ли вход. Обязательно пройдите весь процесс авторизации до конца, чтобы убедиться, что всё работает правильно.

   * Если будет выдана какая-то ошибка, то очистите поля в настройках модуля и сохраните изменения. Когда поля не заполнены, работает обычный механизм авторизации (электронная почта и пароль). Но если поля заполнены (даже с ошибкой), то будет предлагаться только авторизация через Google.

   .. warning::

       Когда вы настроите модуль, только администраторы с электронными адресами Gmail смогут войти в панель администратора. Если у кого-то из ваших администраторов другие электронные адреса, они не смогут войти в панель администратора.
