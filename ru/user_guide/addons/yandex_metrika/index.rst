****************
"Яндекс.Метрика"
****************

.. contents::
    :local: 
    :depth: 2

===========
Возможности 
===========

Модуль “Яндекс.Метрика” позволяет связать ваш магазин с одноимённым сервисом “Яндекс.Метрика”. Подробнее о том, какие возможности даёт этот сервис, а также обо всех настройках на стороне Яндекс.Метрики, вы можете прочитать в `Яндекс.Справке <https://yandex.ru/support/metrica/index.html>`_.

=====================
Установка и настройка
=====================

.. important::

    Установите модуль “Яндекс.Метрика” в ваш магазин так же, как и :doc:`любой другой модуль </user_guide/addons/1manage_addons>`.

Настройте Яндекс.Метрику в три шага:

------------------------------------
Шаг 1. Создание и настройка счётчика
------------------------------------

#. Откройте страницу `Яндекс.Метрики <https://metrika.yandex.ru/>`_ и авторизуйтесь.

#. Нажмите кнопку **Добавить счётчик**.

#. На вкладке "Задайте настройки" заполните необходимые поля:

   * **Имя счётчика** — введите название счётчика.

   * **Адрес сайта** — введите адрес вашего магазина.

   * **Часовой пояс** — выберите ваш часовой пояс.

#. Включите настройку **Вебвизор, карта скроллинга, аналитика форм**, чтобы собирать и анализировать подробные данные о посетителях вашего магазина.

#. Поставьте галочку согласия с условиями пользовательского соглашения и нажмите **Создать счётчик**.

   .. fancybox:: img/metrika5.png
        :alt: Страница создания счётчика Яндекс.Метрика

#. На вкладке "Установите код счетчика на сайт" переключитесь на вкладку **CMS и конструкторы сайта**.

#. Скопируйте код счётчика — его необходимо будет указать в настройках модуля "Яндекс.Метрика". Также его можно скопировать со страницы с детальной информацией о счётчике.

   .. fancybox:: img/metrika4.png
        :alt: Код счётчика Яндекс.Метрика

#. Пролистайте вниз и нажмите **Начать пользоваться**.

-----------------------------------
Шаг 2. Получение API Яндекс.Метрики
-----------------------------------

Для того, чтобы получить API Яндекс.Метрики, вам необходимо зарегистрировать `приложение на Яндекс.OAuth <https://oauth.yandex.ru/client/new>`_.

#. На странице создания приложения заполните необходимые поля:
   
   * **Название приложения** — введите название приложения.

   * **Описание приложения** — введите краткое описание вашего приложения.

   * **Ссылка на сайт приложения** — укажите ссылку на сайт вашего магазина.

#. В разделе “Платформы” выберите **Веб-сервисы**.

#. В поле **Callback URI #1** введите *Callback URI* из настроек модуля “Яндекс.Метрика”.

   .. fancybox:: img/metrika1.png
       :alt: Callback URI в настройках модуля

#. В разделе “Доступы” найдите Яндекс.Метрику и включите все доступы.

#. Нажмите **Создать приложение**. Откроется страница с информацией о вашем приложении. Данные с этой страницы понадобятся вам в следующем шаге по настройке модуля.

----------------------------------------
Шаг 3. Настройка модуля “Яндекс.Метрика”
----------------------------------------

#. В панели администратора откройте страницу **Модули → Управление модулями**.

#. Найдите в списке модуль “Яндекс.Метрика” и нажмите на название модуля, чтобы открыть его настройки.

#. Настройте модуль:

   * **Общие**:

     * **Номер счетчика** — укажите номер счётчика, который вы создали на сайте Яндекс.Метрики.

     * **Устаревший код счётчика** — поставьте галочку, если хотите использовать устаревший код счётчика и предыдущую версию Вебвизора.

   * **Настройки** и **Дополнительные настройки** — выберите сервисы, которые хотите использовать.

   * **Доступ к API Яндекса**:

     * **ID приложения** — укажите ID приложения, которое вы создали в предыдущем шаге.

     * **Пароль приложения** — укажите пароль от вашего приложения.

       .. fancybox:: img/metrika2.png
           :alt: Данные приложения

   * **Цели** — выберите, по каким целям хотите собирать статистику. Выбранные цели настроятся в вашем счётчике автоматически.

     .. fancybox:: img/metrika3.png
         :alt: Цели счётчика

#. В настройках модуля нажмите **Сохранить**.

#. В разделе “Доступ к API Яндекса” нажмите **Обновить токен**, затем авторизуйтесь.

============================================
Что делать, если Яндекс.Метрика не работает?
============================================

Если счётчик Яндекс.Метрики не собирает информацию о вашем магазине или цели не появились автоматически в вашем счётчике, попробуйте выполнить следующие действия:

* Проверьте правильность кода счётчика.

* Проверьте, правильно ли указаны ID и пароль приложения.

* Обновите токен в настройках модуля “Яндекс.Метрика”.

* Подождите некоторое время. Яндекс.Метрика подгружает данные с некоторое задержкой.



