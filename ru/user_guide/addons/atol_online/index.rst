***********
АТОЛ Онлайн
***********

.. note::

    Этот модуль впервые появился в **CS-Cart 4.6.1**.

Модуль интегрирует ваш магазин `с сервисом аренды онлайн-касс "АТОЛ Онлайн" <http://online.atol.ru/>`_. Это полезно тем предпринимателям, которые обязаны применять онлайн-кассы и отправлять электронные чеки покупателям. В статье описано, как установить и настроить модуль, чтобы пробивать чеки.

.. warning::

    Пока что модуль **АТОЛ Онлайн** не адаптирован для работы с подарочными сертификатами. Рекомендуем временно отключить модуль **Подарочные сертификаты**.

.. contents::
    :local: 
    :depth: 1

===========================
Шаг 1. Устанавливаем модуль
===========================

По умолчанию модуль не установлен. Чтобы установить его:

#. В панели администратора откройте страницу **Модули → Управление модулями**.

#. Перейдите на вкладку **Показать все доступные модули**.

#. Найдите в списке модулей **АТОЛ Онлайн**.

#. Нажмите кнопку **Установить**.

   .. fancybox:: img/atol_online_install.png
       :alt: Найдите и установите модуль "АТОЛ Онлайн".

=========================
Шаг 2. Настраиваем модуль
=========================

После установки нужно задать настройки и подключить модуль к сервису "АТОЛ Онлайн". Для этого:

#. В панели администратора откройте страницу **Модули → Управление модулями**.

#. Найдите в списке модулей **АТОЛ Онлайн** и нажмите на его название.

#. Заполните настройки модуля:

   * Вкладка **Общие**:

     * **Валюта** — валюта, цены в которой будут передаваться в "АТОЛ Онлайн". Выбирайте *Рубли* — при отправке цен в "АТОЛ Онлайн" подразумевается, что они приходят туда в рублях.

     * **Статусы оплаченных заказов** — статусы заказов, при которых на онлайн-кассе должен пробиваться чек.

     * **Статусы возвращённых заказов** — статусы заказов, при которых на онлайн-кассе должен пробиваться чек возврата.

     * **Система налогообложения** — выберите вашу систему налогообложения из выпадающего списка.

   .. fancybox:: img/atol_online_general.png
       :alt: Укажите валюту, выберите систему налогообложения и статусы заказов, при которых должны пробиваться чеки и чеки возврата.

   * Вкладка **АТОЛ**:

     .. important::

         Настройки на вкладке **АТОЛ** должны совпадать с данными в личном кабинете "АТОЛ Онлайн". Пока что ещё нельзя задавать разные настройки для разных витрин.

     * **ИНН** — ИНН организации; сравнивается со значением в фискальном накопителе.

     * **Идентификатор группы ККТ** — код группы ККТ, относящейся к интернет-магазину, зарегистрированному в "АТОЛ Онлайн".

     * **Адрес места расчётов** — при расчётах в интернете это адрес сайта; сравнивается со значением в фискальном накопителе.

     * **Логин** — логин пользователя для отправки данных. Его можно получить из файла настроек для CMS в личном кабинете пользователя "АТОЛ Онлайн".

     * **Пароль** — пароль пользователя для отправки данных. Его можно получить из файла настроек для CMS в личном кабинете пользователя "АТОЛ Онлайн".

   .. fancybox:: img/atol_online_atol.png
       :alt: Задайте настройки для соединения с "АТОЛ Онлайн".

#. После того, как вы заполните настройки, нажмите кнопку **Проверить соединение с АТОЛ**. Если всё настроено правильно, то должно появиться сообщение **Соединение прошло успешно**. 

#. Нажмите кнопку **Сохранить**.

=================================
Шаг 3. Настраиваем способы оплаты
=================================

В CS-Cart можно выбрать, при каких способах оплаты ваша онлайн-касса должна пробивать чек. Для этого:

#. В панели администратора откройте страницу **Администрирование → Способы оплаты**.

#. Найдите в списке нужный способ оплаты и нажмите на его название, чтобы открыть страницу редактирования.

#. Выберите **Тип оплаты в ККТ** *Электронная наличность*.

#. Нажмите кнопку **Сохранить**.

#. Повторите эти действия для всех способов оплаты, для которых нужно использовать онлайн-кассу.

   .. fancybox:: img/atol_online_payment_method.png
       :alt: Выберите для способов оплаты, которые нужно регистрировать в ККТ, тип "Электронная наличность".

=========================
Шаг 4. Настраиваем налоги
=========================

Обязательно задайте соответствие между налогами в онлайн-кассе и в CS-Cart. Для этого:

#. В панели администратора откройте страницу **Администрирование →  Доставка и налоги → Налоги**.

#. Нажмите на название налога, чтобы открыть страницу редактирования.

#. В выпадающем списке **Налог в ККТ** выберите налог из онлайн-кассы, которому соответствует этот налог из CS-Cart.

   .. note::

       Убедитесь, что значение настройки **Цена включает налог** и значения на вкладке **Ставки налога** соответствуют налогу в онлайн-кассе, который вы выбрали. Онлайн-касса рассчитывает сумму налога по позициям автоматически.

#. Нажмите кнопку **Сохранить**.

#. Повторите эти действия для всех налогов.

   .. fancybox:: img/atol_online_taxes.png
       :alt: Задайте соответствие между налогами в магазине и налогами в ККТ.

=====================================
Шаг 5. Смотрим чеки и журнал запросов
=====================================

После того, как вы выполнили все шаги с 1 по 4, настройка магазина закончена, а модуль готов к работе. Обратите внимание, что в меню **Модули** теперь есть раздел **АТОЛ Онлайн**.

.. fancybox:: img/atol_online_data.png
    :alt: Новый раздел "АТОЛ Онлайн" в меню "Модули".

Через этот раздел можно попасть на 2 страницы:

* **Чеки** — список чеков. Если хотите пробить тестовый чек, нажмите кнопку с изображением шестерёнки в правой верхней части страницы и выберите действие **Пробить тестовый чек**.

  .. fancybox:: img/atol_online_receipts.png
    :alt: Список чеков "АТОЛ Онлайн".

* **Журнал** — журнал запросов, которые отправил ваш магазин и "АТОЛ Онлайн".

  .. fancybox:: img/atol_online_log.png
    :alt: Журнал запросов "АТОЛ Онлайн".
