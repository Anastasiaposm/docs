*********
RetailCRM
*********

.. note::

    Этот модуль впервые появился в **CS-Cart 4.6.1**. Пока что модуль находится на стадии бета-версии: при его использовании `вы можете столкнуться c багами <https://www.cs-cart.ru/ispravleniye-bagov.html>`_.

CRM — это система управления взаимоотношениями с клиентами. С помощью CRM команда интернет-магазина обрабатывает заказы, налаживает эффективную обратную связь с клиентами и анализирует результаты работы.

**RetailCRM** — это CRM-система, которая специализируется на интернет-торговле. Это облачный сервис: вы ничего не устанавливаете к себе на компьютер, а просто `выбираете тариф на сайте retailCRM <http://www.retailcrm.ru/prices>`_ и подключаетесь к их серверам.

Мы сделали модуль **RetailCRM**, который позволяет CS-Cart обмениваться с retailCRM информацией о заказах, товарах и пользователях. Вы сможете обрабатывать заказы, поступающие в CS-Cart, непосредственно из CRM.

.. contents::
    :local: 
    :depth: 1

==================
Возможности модуля
==================

Сейчас модуль позволяет:

* Задавать соответствия между способами доставки и оплаты, а также статусами заказов в CS-Cart и retailCRM.
    
* Автоматически создавать заказ в retailCRM, когда покупатель оформляет его на витрине в CS-Cart. 

* Присваивать всем заказам, которые покупатели оформляют в CS-Cart, один определённый тип и метод размещения в retailCRM.

* Автоматически изменять заказ в CS-Cart, если он изменён в retailCRM.

* Автоматически добавлять клиентов в retailCRM при оформлении заказа. Если заказ оформил существующий клиент, то модуль добавит заказ этому клиенту.

* Экспортировать каталог товаров из CS-Cart в retailCRM в виде YML-файла.

=================================
Как установить и настроить модуль
=================================

#. Откройте страницу **Модули → Управление модулями** в панели администратора CS-Cart.

#. Перейдите на вкладку **Просмотреть все доступные модули**.

#. Найдите в списке модуль **RetailCRM** и нажмите кнопку **Установить** рядом с модулем.

   .. note::

       Перед этим убедитесь, что :doc:`модуль "YML экспорт" </user_guide/addons/yml_export/index>` установлен и включен. Иначе не получится включить модуль **RetailCRM** и экспортировать каталог товаров.

   .. fancybox:: img/retailcrm_install.png
       :alt: Убедитесь, что установлен модуль "YML экспорт", и только потом устанавливайте модуль "RetailCRM".

#. Нажмите на название модуля, чтобы открыть его настройки.

#. На вкладке **Общие** укажите:

   * **Адрес сервера retailCRM** (в формате *https://your-account-name.retailcrm.ru*);

   * **Ключ доступа к API** (можно найти в retailCRM в разделе **Интеграция → Ключи доступа к API**).

   .. fancybox:: img/retailcrm_settings_general.png
       :alt: Укажите настройки для подключения к retailCRM.

#. Перейдите на вкладку **Соответствия** и нажмите кнопку **Подключиться**.

   .. fancybox:: img/retailcrm_connect.png
       :alt: Нажмите кнопку "Подключиться".

#. Если все данные введены правильно, то на вкладке **Соответствия** появятся настройки, которые вы сможете заполнить:

   * **Магазины** — выберите магазины в retailCRM, которые соответствуют витринам в CS-Cart.

     .. important::

         Не задавайте для разных витрин один и тот же магазин в retailCRM. Если хотите выгружать данные с нескольких витрин, для каждой из них должен быть создан свой магазин в retailCRM.

   * **Статусы заказов** — выберите `статусы заказов в retailCRM <https://www.retailcrm.ru/docs/Users/OrderStatuses#j1>`_, которые соответствуют статусам заказов в CS-Cart.

   * **Способы оплаты** — выберите `типы оплат в retailCRM <https://www.retailcrm.ru/docs/Users/OrderDictionaries#c2>`_, которые соответствуют способам оплаты в CS-Cart.

   * **Способы доставки** — выберите `типы доставок в retailCRM <https://www.retailcrm.ru/docs/Users/OrderDictionaries#c2>`_, которые соответствуют способам доставки в CS-Cart.

   * **Другие настройки:**

     * **Способ оформления заказа** — всем заказам, экспортированным из CS-Cart, будет присвоен этот `способ оформления заказа в retailCRM <https://www.retailcrm.ru/docs/Users/OrderDictionaries#c5>`_.

     * **Тип заказа** — всем заказам, размещаемым в CS-Cart, будет присвоен этот `тип заказа в retailCRM <https://www.retailcrm.ru/docs/Users/OrderDictionaries#c1>`_.

   .. fancybox:: img/retailcrm_correlations.png
       :alt: Задайте соответствия между объектами в CS-Cart и в retailCRM.

#. Нажмите кнопку **Сохранить**.

#. Чтобы экспортировать каталог товаров, :doc:`создайте и настройте прайс-лист </user_guide/addons/yml_export/index>` на странице **Модули → YML экспорт → Прайс-лист**. В настройках прайс-листа поставьте галочку **Прайс-лист для retailCRM**.

   .. fancybox:: img/retailcrm_price_list.png
       :alt: Создайте прайс-лист и укажите, что он для retailCRM.

#. После того, как прайс-лист создан, нажмите **Создание**, а потом **Открыть**. Прайс-лист откроется у вас в браузере, а его URL можно будет скопировать и использовать для `загрузки каталога в retailCRM <https://www.retailcrm.ru/docs/Users/Stores#w04>`_.

   .. fancybox:: img/retailcrm_generate_and_open_yml.png
       :alt: Сгенерируйте и откройте прайс-лист.

#. Чтобы синхронизировать заказы, добавьте в CRON соответствующую задачу, которую можно найти в настройках модуля (см. **Модули → Управление модулями → RetailCRM → Вкладка "Общие"**).

   .. note::

       Если не знаете, как добавить задачу в CRON, обратитесь за помощью к вашему системному администратору.

   .. fancybox:: img/retailcrm_settings_cron.png
       :alt: Задача для CRON по синхронизации заказов в настройках модуля "RetailCRM".
