******************************************************
Как настроить модуль "Местоположение продавцов [Beta]"
******************************************************

.. note::

    Этот модуль работает исключительно в Multi-Vendor и впервые появился в версии 4.8.1.
    
Модуль “Местоположение продавцов [Beta]” позволяет покупателям указывать своё местоположение, чтобы увидеть ближайших к ним продавцов отфильтровать товары по удаленности. Кроме того, модуль отображает продавцов на карте, а также позволяет фильтровать продавцов по городам.

.. contents::
   :backlinks: none
   :local:

Шаг 1: Установите и настройте модуль
====================================

Данный модуль не установлен по умолчанию. 

#. Установите его так же, как и :doc:`любой другой модуль </user_guide/addons/1manage_addons>`, затем щёлкните по названию, чтобы открыть его настройки.

   .. fancybox:: img/vendor_locations_addon.png
       :alt: Модуль Местоположение продавцов не установлен по умолчанию

#. Настройте следующие параметры:

   * **Ключ API Google Maps** — карты Google показывают местоположение продавцов и рассчитывают расстояние до них. Для того, чтобы связать с картами свой маркетплейс, вам понадобится ключ API Google Maps. Получите его, следуя `инструкциям Google <https://developers.google.com/maps/documentation/javascript/get-api-key>`_.
   
   * **Радиус по умолчанию в фильтре по расстоянию** — радиус поиска, который будет по умолчанию установлен в фильтре по расстоянию.
   
   * **Максимальный радиус в фильтре по расстоянию** — максимально допустимый радиус поиска в фильтре по расстоянию.
   
     .. note::
     
         Вы должны вручную добавить фильтр, который позволит покупателям искать товары на определенном расстоянии от их местоположения. В ином случае обе вышеперечисленные настройки не будут работать.
         
   * **Единица измерения расстояния** — единица измерения, которая будет использоваться в фильтре по расстоянию, а также в информации о ближайших продавцах.
   
   * **Продавцы, отображаемые по умолчанию** — определяет, какие продавцы по умолчанию отображаются на странице списка продавцов (``dispatch=companies.catalog``) и на карте на этой странице.
   
     * *Все*;
     
     * *Из города покупателя*;
     
     * *Из страны покупателя*.
     
     .. fancybox:: img/vendor_locations_addon_settings.png
         :alt: Настройки модуля Местоположение продавцов
     
#. Нажмите **Сохранить**.

Шаг 2: Укажите местоположение продавца
======================================

Модуль использует местоположение продавцов на картах Google для расчета расстояния до них и отображения их на карте. Именно по этой причине продавцы должны указывать свои адреса. Владельцы маркетплейсов могут сделать это за них.

#. Откройте страницу **Продавцы → Продавцы**.

#. Щёлкните по имени продавца, чье местоположение вы хотите указать.

#. Найдите поле **Местоположение** и начните вводить адрес. Если модуль настроен правильно, Google автоматически предложит возможные адреса для выбора.

#. После того, как выберете адрес, нажмите **Сохранить**.

   .. fancybox:: img/vendor_location_settings.png
       :alt: Местоположение продавца в соответствии с информацией, указанной в его профиле

Шаг 3: Настройте витрину
========================

После того, как вы указали местоположение продавцов, необходимо разрешить покупателям использовать возможности модуля. Для этого нужно добавить несколько новых блоков и фильтр.

Добавьте блоки, связанные с местоположением
-------------------------------------------

:doc:`Блок </user_guide/look_and_feel/layouts/blocks/index>` — это часть страницы, которая содержит определенную информацию или элемент управления. Нажмите на кнопку **Создать новый блок**, чтобы ознакомиться со списком блоков модуля “Местоположение продавцов [Beta]”, которые вы можете :doc:`добавить на витрину </user_guide/look_and_feel/layouts/blocks/actions_on_blocks>`:

#. **Местоположение покупателя** — блок позволяет покупателям выбирать свое местоположение, чтобы рассчитать расстояние до продавцов. Блок отображает текущее выбранное местоположение. Нажав на него, покупатель открывает всплывающее окно, которое позволяет его изменить.

   .. hint::
   
       Вы можете разместить этот блок в *Верхней панели* или в *Заголовке* на :doc:`странице макета </user_guide/look_and_feel/layouts/layout_pages/index>` **По умолчанию**. Таким образом блок отобразится на всех страницах.
       
#. **Ближайшие продавцы** — блок показывает продавцов, которые находятся ближе всего к покупателю. Расстояние автоматически рассчитывается сервисом Google Maps. Если продавец находится очень близко к покупателю, то численное значение расстояния до него сменится на статус *Близко*.

#. **Карта продавцов** — блок отображает карту Google с отмеченными на ней продавцами.

#. **Поиск по местоположению** — блок представляет собой фильтр для карты продавцов. Позволяет покупателям выбирать город, чтобы на карте отображались только продавцы из определенного города.

   .. note::
   
   Блоки *Карта продавцов* и *Поиск по местоположению* автоматически добавляются на страницу со списком продавцов (``dispatch=companies.catalog``) после установки модуля. Если вы хотите их убрать, отредактируйте макет страницы **Продавцы** на странице **Дизайн → Макеты**.
   
   .. fancybox:: img/nearby_vendors_and_map.png
       :alt: Четыре блока модуля Местоположение продавцов на одной странице

Добавьте фильтр товаров по расстоянию
-------------------------------------

:doc:`Фильтр </user_guide/manage_products/filters/index>` позволяет покупателям ограничивать список товаров, отображаемых в соответствии с определенными критериями. Модуль “Местоположение продавцов [Beta]” позволяет выбирать местоположение и производить поиск товаров на определенном расстоянии от этого местоположения.

.. fancybox:: img/filter_by_distance.png
    :alt: Товары могут быть отфильтрованы по расстоянию от указанного местоположения

С информацией о том, как добавить новый фильтр, вы можете ознакомиться в :doc:`этой статье </user_guide/manage_products/filters/adding_filter>`. Чтобы создать фильтр по расстоянию, в поле **Фильтровать по** установите значение *Расстояние до продавца*.

.. fancybox:: img/distance_to_vendor_filter.png
    :alt: Фильтрование товаров по расстоянию до продавца

