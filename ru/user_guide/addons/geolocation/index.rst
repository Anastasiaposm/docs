***********************************
Модуль "Определение местоположения"
***********************************

Модуль "Определение местоположения" добавляет окно с возможностью указать свой город при входе на сайт. Город определяется автоматически, а покупатель может подтвердить его или изменить. Данные о городе подставляются в форму оформления заказа и рассчета стоимости доставки.

Для работы данного модуля необходимо установить :doc:`модуль "Города" <../cities/index>`.

Установка и настройка модуля
----------------------------

1.  Установите модуль "Города" (:doc:`см. "Установка модулей" <../1manage_addons>`).

    .. image:: img/geolocation_01.png
        :alt: Модуль "Определение местоположения"

2.  Установите модуль "Определение местоположения" (:doc:`см. "Установка модулей"  <../1manage_addons>`).

    .. image:: img/geolocation_02.png
        :alt: Модуль "Определение местоположения"

    Настройки модуля:

        *   Способ определения местоположения:

            -   Yandex - определять местоположение по данным Яндекса на основе IP-адреса пользователя.

            -   Браузер - использовать встроенные средства браузера для определения местоположения.

            -   Автоматический (Браузер + Yandex) - использовать оба способа и выбрать лучшее значение.

        *   Отображать способы доставки - на детальной странице товара будет отображаться список с возможноми способами доставки для выбранного города.

        *   Список отображаемых городов - список городов, которые будут отображаться в окне определения города.

        .. image:: img/geolocation_03.png
            :alt: Модуль "Определение местоположения"

    .. note::

        Если в настройке "Список отображаемых городов" модуля "Определение местоположения" не указан ни один город, то будут отображаться все города из раздела "Пункты назначения" (Верхнее меню → Администрирование → Доставка и налоги → Пункты назначения)

4.  Перейдите на страницу "Макеты" ( Верхнее меню → Дизайн → Макеты ) и создайте блок "Определение города". Этот блок позволяет изменить выбранный город.

    .. note::

        Без этого блока окно с выбором города не появится.

    .. image:: img/geolocation_04.png
        :alt: Модуль "Определение местоположения"

5.  Выберите во вкладке "Создать новый блок" блок "Определение города", задайте название блока и нажмите кнопку "Создать".

    .. image:: img/geolocation_05.png
        :alt: Модуль "Определение местоположения"


Как работает модуль
-------------------

1.  Перейдите в магазин. В браузере отобразится окно с выбором города и сообщение с вопросом о предоставлении доступа для определения местоположения. В случае если вы нажмете на кнопку "Запретить", то в качестве вашего место положения будет выбран город по умолчанию.

    .. image:: img/geolocation_06.png
        :alt: Модуль "Определение местоположения"

    .. image:: img/geolocation_07.png
        :alt: Модуль "Определение местоположения"

2.  Если город в поле определен верно, нажмите на кнопку "Город определен верно". Если город определен неверно, то можно выбрать город из списка или ввести его вручную.

    .. image:: img/geolocation_08.png
        :alt: Модуль "Определение местоположения"

3.  Выбранный город будет отображаться в блоке "Определение местоположения".

    .. image:: img/geolocation_09.png
        :alt: Модуль "Определение местоположения"

    Для изменения города нажмите на ссылку города в блоке и измените на нужный город.

4.  При переходе на страницу товара отобразится список способов доставки для выбранного города. Также отобразится стоимость доставки для одной единицы товара. Если для выбранного города не задан способ доставки, то отобразится надпись "К сожалению, мы не можем доставить товар в ваш город".

    .. image:: img/geolocation_10.png
        :alt: Модуль "Определение местоположения"

5.  При расчете доставки на странице корзины в поле "Город" автоматически подставится выбранный город.

    .. image:: img/geolocation_11.png
        :alt: Модуль "Определение местоположения"

6. При оформлении заказа как гость в качестве города покупателя автоматически подставится выбранный город.

    .. image:: img/geolocation_12.png
        :alt: Модуль "Определение местоположения"
