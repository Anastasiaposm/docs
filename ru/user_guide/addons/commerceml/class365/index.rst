*****************************************************************
Настройка обмена данными с системой Class365 в формате CommerceML
*****************************************************************

Инструкция по настройке обмена данными системы Class365 в формате CommerceML с интернет-магазином на платформе CS-Cart.

.. contents:: Содержание
    :local: 
    :depth: 3


Настройки в системе Class365
----------------------------

Для начала работы зарегистрируйтесь в системе Class365.

Официальный сайт:  |link|

.. |link| raw:: html

   <!--noindex--><a href="https://class365.ru" target="_blank" rel="nofollow">class365.ru</a><!--/noindex-->

.. fancybox:: img/class365_01.png
    :alt: Обмен данными Class365

Настройте обмен с интернет-магазином
====================================

Сначала нужно настроить обмен в системе "Class365".

#. В системе "Class365" зайдите в "Администрирование" - "Интеграция с интернет-магазинами".

   .. fancybox:: img/class365_02.png
       :alt: Обмен данными Class365

#. В окне интеграции добавьте новый магазин "Добавить интернет-магазин" - "CS-Cart".

   .. fancybox:: img/class365_03.png
       :alt: Обмен данными Class365

#. В окне "Интеграция с интернет-магазином" заполните поля:

   *   Адрес магазина — адрес скрипта, который будет обрабатывать выгружаемые файлы (например, http://my_site.ru/exim_class)
    
       .. hint:: Если проверка соединения не сработала с http-адресом, попробуйте https: https://my_site.ru/exim_class.

   *   Логин — логин администратора магазина, у которого установлены права для обмена

   *   Пароль — пароль администратора магазина

   *   Выгрузка товаров — настройки выгрузки товаров

   *   Загрузка заказов — настройки для загрузки заказов

   .. fancybox:: img/class365_04.png
       :alt: Обмен данными Class365

   .. fancybox:: img/class365_05.png
       :alt: Обмен данными Class365

Настройки в интернет-магазине
-----------------------------

Для обмена данными "Class365" с интернет-магазином установите модуль "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365" (:doc:`см. "Установка модулей" <../../1manage_addons>`). 

.. note:: 

    Панель администратора → Верхнее меню → Модули → Управление модулями → "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365"

.. fancybox:: /user_guide/addons/commerceml/img/commerceml_addon.png
   :alt: Модуль CommerceML в CS-Cart.

После установки модуля откройте его настройки. 

Окно "Настройки модуля" содержит вкладки:

* Общие настройки

* Характеристики

* Цены

* Доставка

* Заказы

* Товарные предложения

Выбор версии схемы
==================

В настройках модуля "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365" есть настройка выбора схемы, которая определяет формат загрузки характеристик(опций) товара.
Для определения версии схемы, необходимо:

#. Нажать на ссылку "Скачать файлы" в окне "Интеграция с интернет-магазином".

    .. fancybox:: img/class365_08.png
        :alt: Обмен данными Class365

#. Открыть выгруженные файлы import.xml и offers.xml. В файлах осуществить поиск тега ``<ХарактеристикиТовара>``.

    .. fancybox:: img/class365_09.png
        :alt: Обмен данными Class365

#. Если тег ``<ХарактеристикиТовара>`` нашелся в файле import или в обоих файлах, то необходимо выбрать версию схемы 2.07. Если тег нашёлся только в файле offers, то выбрать версию схемы 2.05.

Общие настройки
===============

Вкладка "Общие настройки" содержит следующие поля:

.. fancybox:: /user_guide/addons/commerceml/img/commerceml_general_settings.png
   :alt: Общие настройки модуля CommerceML в CS-Cart.

.. list-table::
    :widths: 15 30

    *   -   Версия схемы

        -   В зависимости от формата передаваемых данных, необходимо выбрать соответствующую версию схемы:

            *   2.05 - выберите, если характеристики товара выгружаются только в файл offers. Выгрузка вариаций товаров из Класс365 в CS-Cart работает только со схемой 2.05.

            *   2.07 - выберите, если характеристики товара выгружаются в файл import.

    *   -   Язык по умолчанию

        -   Определяет, какой язык будет использоваться для записи данных.

    *   -   Значение для связывания категорий

        -   Используется для связывания категорий в Класс365 с их аналогами в CS-Cart.

    *   -   Значение для связывания товаров

        -   Используется для связывания товаров в Класс365 с их аналогами в CS-Cart.

    *   -   Загружать товары

        -   Параметр определяющий какие товары будут загружаться в магазин:

            * Все товары

            * Новые товары

            * Новые товары и все цены товаров

            * Только обновление товаров

            * Не загружать

    *   -   Разрешить импорт категорий

        -   Определяет, будут ли загружаться группы из Класс365. Если данная настройка отключена, то товары будут записаны в категорию, указанную в настройке "Категория по умолчанию".

    *   -   Категория по умолчанию

        -   Категория, в которую будут добавлены новые товары из Класс365, если настройка "Разрешить импорт категорий" выключена.

    *   -   Скрывать товары, которых нет в наличии

        -   Автоматически присваивает товарам статус "Скрыто", если количество товара равно 0.

    *   -   Добавлять налог к товарам.

        -   Товарам будут добавлены налоги, используемые в Класс365.

            Настройки выгрузки налогов доступны на странице "Модули → Настройки CommerceML → Соответствие налогов".

            Для настройки выгрузки налогов необходимо указать соответствия налогов в CS-Cart и процентной ставки в Класс365.

    *   -   Импортировать изображения как дополнительные

        -   Все изображения товара будут загружены как дополнительные.

    *   -   Использовать в названии товара

        -   Параметр, определяющий какие данные будут записываться в наименование товара:

            *   Рабочее наименование 

            *   Наименование для печати

    *   -   Использовать в коде товара

        -   Определяет какие данные будут записываться в поле артикула товара:

            * Артикул

            * Код номенклатуры

            * Штрихкод

    *   -   Использовать в полном описании товара

        -   Определяет какие данные будут записываться в качестве полного описания товара:

            * Текстовое описание

            * Файл описания для сайта

            * Наименование для печати

    *   -   Использовать в кратком описании товара

        -   Определяет какие данные будут записываться в качестве краткого описания товара:

            * Текстовое описание

            * Файл описания для сайта

            * Наименование для печати

    *   -   Использовать в название страницы (SEO)

        -   Параметр, определяющий какие данные будут записываться в поле название страницы:

            * Наименование

            * Полное наименование

Характеристики
==============
        
Вкладка "Характеристики" содержит следующие настройки:

.. fancybox:: /user_guide/addons/commerceml/img/commerceml_features.png
   :alt: Импорт характеристик по CommerceML в CS-Cart.

.. list-table::
    :widths: 15 30

    *   -   Разрешить импорт свойств

        -   Свойства из Класс365 будут загружены в магазин.

    *   -   Название свойства для промо-текста

        -   В качестве промо-текста для товара будет загружено значение указанного свойства из Класс365.

    *   -   Значение, используемое в качестве бренда

        -   Определяет, будет ли использоваться бренд:

            * Не использовать

            * Значение изготовителя

            * Свойство товара

    *   -   Название свойства для бренда

        -   В качестве бренда будет загружено указанное свойство из Класс365.

    *   -   Настройка запрета/разрешения выгрузки свойств

        -   Выбор метода исключения для загружаемых свойств:

            * Не использовать функцию запрета/разрешения выгрузки свойств

            * Загружать только

            * Не загружать

    *   -   Список свойств для запрета/разрешения выгрузки

        -   Список свойств для разрешения или запрета загрузки. Каждое свойство необходимо вводить с новой строки.

Цены
====
        
Вкладка "Цены" содержит настройки загрузки цен:

.. fancybox:: /user_guide/addons/commerceml/img/commerceml_price_settings.png
   :alt: Настройки импорта цен по CommerceML в CS-Cart.

Если настройка **Импортировать только количество и цены** включена, то в магазин будут загружены только новые товары и выполнится обновление цен и количества товаров.
   
Выберите настройку **Загружать несколько цен** для загрузки нескольких цен (Базовая цена, Рекомендованная цена, Оптовые цены). 

Загрузка нескольких цен реализована с помощью цен для групп пользователей. Вы можете задать для каждой группы пользователей (Опт, Розница, Золотой клиент) свою цену на товар.

Для настройки выгрузки цен и соответствия цен группам пользователей в CS-Cart перейдите на страницу "Модули → Настройки CommerceML → Соответствие цен".

Если существует необходимость выгрузки нескольких видов цен в одну цену, то их можно добавить в настройках через запятую.

Страница "Соответствие цен" содержит поля:

* "Базовая цена" — это цена товара по умолчанию для всех групп пользователей; 

* "Рекомендованная цена" — это рекомендованная цена товара в разделе "Ценообразование/наличие";

* "Цена в магазине" — это цена, которая будет доступна для указанной группы пользователей.
    
.. fancybox:: /user_guide/addons/commerceml/img/commerceml_prices.png
   :alt: Таблица соответствия цен в системе учёта и в CS-Cart при обмене по CommerceML.

Для проверки введенных названий цен (соглашений) в модуле предусмотрено тестирование выгружаемых цен. Для тестирования:

#. Установите галочку "Запустить режим отладки цен" в настройках модуля.

#. В Класс365 у "Выгрузка товаров" нажмите на ссылку "Выгрузить сейчас".

#. Перейдите на страницу "Соответствие цен" в панели администратора и посмотрите результат.

#. Для полноценной выгрузки уберите галочку "Запустить режим отладки цен" в настройках модуля "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365" и повторите выгрузку.


Доставка
========
    
Вкладка "Доставка" настраивает загрузку дополнительных реквизитов номенклатуры (в одном поле можно указать несколько реквизитов для каждого вида номенклатуры с новой строки) и содержит следующие настройки:
    
.. fancybox:: /user_guide/addons/commerceml/img/commerceml_shipping.png
   :alt: Настройки доставки в модуле CommerceML в CS-Cart.

.. list-table::
    :widths: 15 30

    *   -   Наименование свойства для веса

        -   Выгружаемый дополнительный реквизит номенклатуры.

    *   -   Отображать вес, как характеристику

        -   По весу товара будет создана характеристика, для фильтра товаров по характеристикам.

    *   -   Наименование свойства для бесплатной доставки

        -   Выгружаемый дополнительный реквизит номенклатуры.

    *   -   Отображать бесплатную доставку как характеристику

        -   По параметру "Бесплатная доставка товара" будет создана характеристика товара.

    *   -   Стоимость доставки

        -   Дополнительный реквизит номенклатуры.

    *   -   Количество штук в коробке

        -   Дополнительный реквизит номенклатуры.

    *   -   Длина коробки

        -   Дополнительный реквизит номенклатуры.

    *   -   Ширина коробки

        -   Дополнительный реквизит номенклатуры.

    *   -   Высота коробки

        -   Дополнительный реквизит номенклатуры.

Заказы
======
    
Вкладка "Заказы" содержит следующие поля:

.. fancybox:: /user_guide/addons/commerceml/img/commerceml_orders.png
   :alt: Настройки синхронизации заказов по CommerceML в CS-Cart.

.. list-table::
    :widths: 15 30
    
    *   -   Включать отдельно стоимость доставки заказа
    
        -   Доставка будет выгружена в виде отдельной номенклатуры.

    *   -   Выгружать опции товара
    
        -   В заказах товары, имеющие опции, будут выгружаться с опциями. Будут загружаться только те опции, которые изначально были созданы в системе учёта; опции созданные в магазине загружаться не будут.

    *   -   Выгружать с номера
    
        -   Для загрузки будут доступны заказы, начиная с указанного номера.

    *   -   Загружать статусы заказов
    
        -   В магазин будут загружены статусы для соответствующих заказов, выгруженные в файл orders.

    *   -   Выгружать статусы заказов
    
        -   Из магазина будут выгружены заказы со статусами.

    *   -   Выгрузить все товары магазина

        -   Заказы из магазина выгружаться не будут. Вместо этого будут выгружены все включенные товары, у которых включена настройка "Обновлять товар".

    *   -   Статусы выгружаемых заказов
    
        -   Статусы заказов, которые будут выгружены.


Товарные предложения
====================
        
Эквивалентом товарных предложений в CS-Cart являются :doc:`вариации товаров </user_guide/manage_products/products/product_variations>`. Если установлен и включен модуль :doc:`Вариации товаров </user_guide/addons/product_variations/index>`, то для импорта товарных предложений больше ничего не потребуется.

.. important::

    В старых версиях вместо вариаций были комбинации опций. Если вы раньше выгружали из Класс365 их, то после обновления вы всё ещё сможете это делать. На вкладке "Товарные предложения" в этом случае у вас будет возможность переключиться на вариации.

.. fancybox:: /user_guide/addons/commerceml/img/commerceml_offers.png
   :alt: Настройки выгрузки товарных предложений в CS-Cart по CommerceML.

Обмен данными между Класс365 и CS-Cart
--------------------------------------

Обмен данными между Класс365 и CS-Cart можно осуществлять одним из способов:

* Автоматический запуск

  Для автоматического запуска обмена необходимо в настройках синхронизации Класс365 включить настройку "Выгружать каждые", "Загружать каждые" и указать время.

* Ручной запуск

  Для запуска обмена данными в настройках синхронизации Класс365 нажмите на ссылку "Выгрузить сейчас" и "Загрузить сейчас".

.. fancybox:: img/class365_18.png
    :alt: Обмен данными Class365

После обмена появится сообщение о результате выгрузки и загрузки.
    
.. fancybox:: img/class365_19.png
    :alt: Обмен данными Class365

.. fancybox:: img/class365_20.png
    :alt: Обмен данными Class365
