***************************************************
Обмен данными между интернет-магазином и 1С УТ 10.3
***************************************************

Инструкция по настройке обмена данными между 1С и интернет-магазином на платформе CS-Cart.

.. contents:: Содержание
    :local: 
    :depth: 3


Настройки в 1С
--------------

Для начала работы с 1С откройте базу данных, с которой будет производиться обмен. 

Для этого запустите файл "1сv8.exe", в открывшемся окне выберите базу данных, с которой будет производиться обмен, и нажмите на кнопку "1С:Предприятие".

.. fancybox:: img/image10_001.png
    :alt: Обмен данными 1C и CS-Cart

После запуска необходимо выбрать пользователя и ввести пароль (если у пользователя задан пароль).

.. fancybox:: img/image10_002.png
    :alt: Обмен данными 1C и CS-Cart

Если пользователь и пароль введены правильно, откроется окно "Демонстрационная база".

.. fancybox:: img/image10_003.png
    :alt: Обмен данными 1C и CS-Cart

Настройка процесса обмена (узел обмена)
=======================================

Для создания узла обмена перейдите в меню "Сервис" - "Обмен данными с WEB-сайтом" - "Настроить обмен данными с WEB-сайтом".

    .. fancybox:: img/image10_004.png
        :alt: Обмен данными 1C и CS-Cart

В окне "Настройка обмена данными с WEB-сайтом" заполните необходимые поля на каждом шаге:

    *   Шаг 1 

        В окне "Настройка обмена данными с WEB-сайтом" введите:

            -   Адрес сайта - url используемая для обмена

            -   Пользователь - логин администратора магазина

            -   Пароль - пароль администратора магазина

            .. note::

                После заполнения полей проверьте выполняется ли соединение нажав на кнопку "Проверить"

            .. fancybox:: img/image10_005.png
                :alt: Обмен данными 1C и CS-Cart

    *   Шаг 2

        После ввода данных для соединения нажмите на кнопку "Далее", на шаге заполнения классификатора номенклатуры ничего заполнять не нужно, нажмите на кнопку "Далее".

        .. fancybox:: img/image10_006.png
            :alt: Обмен данными 1C и CS-Cart

    *   Шаг 3

        Вы можете задать отбор (указать условия по которым будет выгружаться номенклатура). Также вы можете указать какие данные товара будут выгружатся.

        .. fancybox:: img/image10_007.png
            :alt: Обмен данными 1C и CS-Cart

    *   Шаг 4

        Заполните настройки для обмена заказами.

        .. fancybox:: img/image10_008.png
            :alt: Обмен данными 1C и CS-Cart

    *   Шаг 5

        Заполните настройки для загружемых заказов.

        .. fancybox:: img/image10_009.png
            :alt: Обмен данными 1C и CS-Cart

    *   Шаг 6

        Укажите режим обмена данными.

        .. fancybox:: img/image10_010.png
            :alt: Обмен данными 1C и CS-Cart

    *   Шаг 7

        Укажите когда необходимо запускать обмен, если необходимо выполнять обмен по расписанию.

        .. fancybox:: img/image10_011.png
            :alt: Обмен данными 1C и CS-Cart

Настройки в интернет-магазине
-----------------------------

Для обмена данными 1С с интернет-магазином установите модуль "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365" (:doc:`см. "Установка модулей" </user_guide/addons/1manage_addons>`). 

.. note:: 

    Панель администратора → Верхнее меню → Модули → Управление модулями → "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365"

.. fancybox:: img/image10_012.png
   :alt: Обмен данными 1C и CS-Cart

После установки модуля откройте его настройки. 

Окно "Настройки модуля" содержит вкладки:

*   Общие настройки

*   Настройки свойств

*   Настройки опций

*   Настройки цен

*   Параметры доставки

*   Настройки заказов


.. fancybox:: img/image10_013.png
   :alt: Обмен данными 1C и CS-Cart
   
Выбор версии схемы
==================

В настройках модуля "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365" есть настройка выбора схемы, которая определяет формат загрузки характеристик(опций) товара.
Для определения версии схемы, необходимо:

1. Создать в 1С товар с характеристикой и сделать выгрузку в файл.

2. Открыть выгруженные из 1С файлы import.xml и offers.xml. В файлах осуществить поиск тега ``<ХарактеристикиТовара>``.

3. Если тег ``<ХарактеристикиТовара>`` нашелся в файле import или в обоих файлах, то необходимо выбрать версию схемы 2.07. Если тег нашелся только в файле offers или ни в одном из файлов, то выбрать версию схемы 2.05.


Общие настройки
===============

Вкладка "Общие настройки" содержит следующие поля:

.. fancybox:: img/image10_014.png
   :alt: Обмен данными 1C и CS-Cart

.. list-table::
    :widths: 15 30

    *   -   Версия схемы

        -   В зависимости от формата передаваемых данных, необходимо выбрать соответствующую версию схемы:

            *   2.05 - выберите, если характеристики товара выгружаются только в файл offers

            *   2.07 - выберите, если характеристики товара выгружаются в файл import

    *   -   Язык по умолчанию

        -   Настройка определяющая какой язык будет использоваться для записи данных.

    *   -   Значение для связывания категорий

        -   Значение используемое для связывания категорий.

    *   -   Значение для связывания товаров

        -   Значение используемое для связывания товаров.

    *   -   Загружать товары

        -   Определяет какие товары будут загружатся из файла import.xml.

    *   -   Разрешить импорт категорий

        -   Параметр, определяющий будут ли загружаться группы из 1С. Если данная настройка отключена, то товары будут записаны в категорию указанную в настройке "Общая категория для товаров".

    *   -   Общая категория для товаров

        -   Категория в которую будут добавлены товары из 1С, если настройка "Разрешить импорт категорий" выключена.

    *   -   Тип для категории выгружаемой из 1С

        -   Тип присваиваемой категории выгружаемой из 1С:

            *   Главная (Категория загружаемая из 1С будет отмечена как главная)

            *   Дополнительная

    *   -   Скрывать товары, которых нет в наличие

        -   Автоматически присваивает товарам статус "Скрыто", если количество товара равно 0.

    *   -   Добавлять налог к товарам.

        -   Товарам будут добавлены налоги, используемые в 1С. 

            Настройки выгрузки налогов доступны на странице "Модули → Настройки CommerceML → Соответствие налогов".

            Для настройки выгрузки налогов необходимо указать соответствия налогов в CS-Cart и процентной ставкой в 1С.

    *   -   Импортировать изображения как дополнительные

        -   Все изображения товара будут загружены как дополнительные.

    *   -   Использовать в названии товара

        -   Параметр, определяющий какие данные будут записываться в наименование товара:

            *   Рабочее наименование 

            *   Наименование для печати

    *   -   Использовать в коде товара

        -   Определяет какие данные будут записываться в поле код товара:

            *   Артикул

            *   Код номенклатуры

            *   Штрихкод

    *   -   Использовать в полном описании товара

        -   Определяет какие данные будут записываться в качестве полного описания товара:

            *   Текстовое описание

            *   Файл описания для сайта

            *   Наименование для печати

    *   -   Использовать в кратком описании товара

        -   Определяет какие данные будут записываться в качестве краткого описания товара:

            *   Текстовое описание

            *   Файл описания для сайта

            *   Наименование для печати

    *   -   Использовать в название страницы (SEO)

        -   Параметр, определяющий какие данные будут записываться в поле название страницы:

            *   Наименование

            *   Полное наименование


Настройка свойств
=================
        
Вкладка "Настройка свойств" содержит следующие настройки:

.. fancybox:: img/image10_016.png
   :alt: Обмен данными 1C и CS-Cart

.. list-table::
    :widths: 15 30

    *   -   Разрешить импорт свойств

        -   Свойства из 1С будут загружены в магазин.

    *   -   Название свойства для промо-текста

        -   В качестве промо-текста для товара будет загружено значение указанного свойства из 1С.

    *   -   Значение, используемое для бренда

        -   Значение, которое будет загружено в качестве бренда.

    *   -   Название свойства для бренда

        -   В качестве бренда будет загружено указанное свойство из 1С, если в поле "Значение используемое для бренда" выбрано значение "Свойство товара".

    *   -   Настройка запрета/разрешения выгрузки свойств

        -   Выбор метода исключения для загружаемых свойств:

            *   Не использовать функцию запрета/разрешения выгрузки свойств

            *   Загружать только

            *   Не загружать

    *   -   Список свойств для запрета/разрешения выгрузки

        -   Список свойств для разрешения или запрета загрузки. Каждое свойство необходимо вводить с новой строки.


Настройка опций
===============
        
Вкладка "Настройка опций" содержит следующие настройки:

.. fancybox:: img/image10_017.png
   :alt: Обмен данными 1C и CS-Cart

.. list-table::
    :widths: 15 30

    *   -   Тип опций

        -   Тип для отображения опций товара загруженных из 1С:

            *   Список вариантов

            *   Радиогруппа

    *   -   Способы загрузки опций.

        -   Способ загрузки опций товара из 1С:

            *   Стандартный способ - создается опция с именем заданным в поле "Название опции", в качестве вариантов добавляются комбинации характеристик номенклатуры из 1С.

            *   "Отдельно общими значениями" - создаются опции по каждой характеристике номенклатуры из 1С.

            *   "Отдельно индивидуальными значениями" - создаются индивидуальные опции для товаров по каждой характеристике номенклатуры из 1С.

    *   -   Название опции

        -   Название опции используемое для комбинаций характеристик номенклатуры загружаемой из 1С, при выборе в настройке "Способ загрузки опций" значение "Стандартный способ".


Настройки цен
=============
        
Вкладка "Настройки цен" содержит настройки загрузки цен:

.. fancybox:: img/image10_018.png
   :alt: Обмен данными 1C и CS-Cart

Если настройка **Импортировать количество и цены** включена, то в магазин будут загружаться цены и количество товаров, выгруженных из 1С.
   
Включите настройку **Загружать несколько цен** для загрузки нескольких цен (Базовая цена, Рекомендованная цена, Оптовые цены).

Настройка **Запустить режим отладки цен** нужна для проверки цен, введённых на странице "Модули → Настройки CommerceML → Соответствие цен".

При включении настройки **Общая цена товаров**, для товара у которого есть опция, в качестве цены товара будет загружатся последняя цена опции.

Загрузка нескольких цен реализована с помощью цен для групп пользователей. Вы можете задать для каждой группы пользователей (Опт, Розница, Золотой клиент) свою цену на товар.

Для настройки выгрузки цен и соответствия цен группам пользователей в CS-Cart перейдите на страницу "Модули → Настройки CommerceML → Соответствие цен".

Если существует необходимость выгрузки нескольких видов цен в одну цену, то их можно добавить в настройках через запятую.

Страница "Соответствие цен" содержит поля:

*   "Базовая цена" - это цена товара по умолчанию для всех групп пользователей; 

*   "Рекомендованная цена" - это рекомендованная цена товара в разделе "Ценообразование/наличие";

*   "Цена в магазине" - это цена, которая будет доступна для указанной группы пользователей.
    
.. fancybox:: img/image10_019.png
   :alt: Обмен данными 1C и CS-Cart


Для проверки введенных названий цен (соглашений) в модуле предусмотрено тестирование выгружаемых цен. Для тестирования:

1.  Установите галочку "Запустить режим отладки цен" в настройках модуля.

2.  В 1С произведите выгрузку в интернет-магазин.

3.  Далее перейдите на страницу "Соответствие цен" в панели администратора и посмотрите результат. Внесите исправление и обновите страницу. 

4.  Для полноценной выгрузки уберите галочку "Запустить режим отладки цен" в настройках модуля "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365" и повторите выгрузку.


Параметры доставки
==================
    
Вкладка "Параметры доставки" настраивает загрузку дополнительных реквизитов номенклатуры (в одном поле можно указать несколько реквизитов для каждого вида номенклатуры с новой строки) и содержит следующие настройки:
    
.. fancybox:: img/image10_020.png
   :alt: Обмен данными 1C и CS-Cart

.. list-table::
    :widths: 15 30

    *   -   Наименование свойства для веса

        -   Выгружаемый дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.

    *   -   Отображать вес, как характеристику

        -   По весу товара будет создана характеристика, для фильтра товаров по характеристикам.

    *   -   Наименование свойства для бесплатной доставки

        -   Выгружаемый дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Булево.

    *   -   Отображать бесплатную доставку как характеристику

        -   По параметру "Бесплатная доставка товара" будет создана характеристика товара.

    *   -   Стоимость доставки

        -   Дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.

    *   -   Количество штук в коробке

        -   Дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.

    *   -   Длина коробки

        -   Дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.

    *   -   Ширина коробки

        -   Дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.

    *   -   Высота коробки

        -   Дополнительный реквизит номенклатуры. Тип значения реквизита в 1С - Число.

Настройки заказов
=================
    
Вкладка "Настройки заказов" содержит следующие поля:

.. fancybox:: img/image10_021.png
   :alt: Обмен данными 1C и CS-Cart

.. list-table::
    :widths: 15 30
    
    *   -   Включать отдельно стоимость доставки заказа
    
        -   Доставка будет выгружена в виде отдельной номенклатуры.

    *   -   Выгружать опции товара
    
        -   В заказах товары, имеющие опции, будут выгружаться с опциями. Будут загружатся только те опции, которые изначально были созданы в 1С; опции созданные в магазине загружатся не будут.

    *   -   Выгружать с номера
    
        -   Для загрузки будут доступны заказы, начиная с указанного номера.

    *   -   Загружать статусы заказов
    
        -   В магазин будут загружены статусы для соответствующих заказов, выгруженные в файл orders.

    *   -   Выгружать статусы заказов
    
        -   Из магазина будут выгружены заказы со статусами.

    *   -   Выгрузить все товары магазина

        -   Заказы из магазина выгружаться не будут. Вместо этого будут выгружены все включенные товары, у которых включена настройка "Обновлять товар".

    *   -   Статусы выгружаемых заказов
    
        -   Статусы заказов, которые будут выгружены.

Обмен данными между 1С и CS-Cart
--------------------------------

Обмен данными между 1С и CS-Cart можно осуществлять одним из способов:

*   Автоматический запуск
    
    Для автоматического запуска обмена достаточно настроить расписание автоматического обмена данными в форме узла обмена данными.

*   Ручной запуск 

    Для запуска обмена данными откройте созданный узел обмена и нажмите на кнопку "Выполнить обмен", будет запущен процесс обмена, по окончании которого будет выдано соответствующее сообщение.

.. fancybox:: img/image10_022.png
   :alt: Обмен данными 1C и CS-Cart

Для анализа результатов обмена используется журнал регистрации «1С: Предприятия». 

Для просмотра событий выгрузки данных в окне созданного узла обмена необходимо нажать кнопку "Действия - Монитор обменов", откроется окно "Монитор настроек обмена данными".
    
.. fancybox:: img/image10_023.png
    :alt: Обмен данными 1C и CS-Cart
