**************************************************
Обмен заказами между интернет-магазином и 1С УТ 11
**************************************************

Здесь описан процесс обмена заказами между интернет-магазином на платформе CS-Cart и 1С Управление торговлей 11. Аналогичным образом можно настроить обмен с другой версией 1С.

.. note::

    В зависимости от версии, некоторые настройки могут быть видоизменены или отсутствовать. По поводу настроек на стороне 1С обратитесь к администратору 1С.

.. contents:: Содержание
    :local: 
    :depth: 3

Настройки в 1С
--------------

1. Откройте базу данных, с которой будет производиться обмен.

   .. fancybox:: img/order1c_001.png
       :alt: Обмен заказами 1C и CS-Cart

2. Проверьте настройки 1С (см. :doc:`Настройки обмена <../../instruction/index>`).

3. Создайте типовое соглашение (см. :doc:`Настройки обмена <../../instruction/index>`).

4. Создайте узел обмена: 

   * В основных настройках узла включите настройку "Обмен заказами".

     .. fancybox:: img/order1c_002.png
         :alt: Обмен заказами 1C и CS-Cart

   * Во вкладке "Обмен заказами" выполните настройку:

     * "Дата заказа на сайте" — укажите, в какой реквизит будет выгружаться дата создания заказа. 

         Чтобы создать реквизит:

         * Откройте "Администрирование → Общие настройки".

         * В окне "Общие настройки" нажмите на ссылку "Дополнительные реквизиты".

           .. fancybox:: img/order1c_003.png
               :alt: Обмен заказами 1C и CS-Cart

         * В окне "Дополнительные реквизиты" перейдите в папку "Заказ клиента" и создайте дополнительный реквизит: в правом верхнем углу нажмите Все действия → Добавить → Новый. Для реквизита "Дата заказа на сайте" обязательно должен быть задан тип "Дата".

           .. fancybox:: img/order1c_004.png
               :alt: Обмен заказами 1C и CS-Cart

     * "Номер заказа на сайте" — создайте реквизит для значения номера заказа. Делается это по аналогии с созданием реквизита для "Дата заказа на сайте".

     * "Соглашение" — выберите созданное типовое соглашение.

     * "Организация" — выберите организацию, осуществляющую заказ.

     * "Склад" — выберите склад, используемый при создании заказа в 1С.

     * "Менеджер" — выберите менеджера, который будет использоваться при создании заказа в 1С.

     * "Способ поиска существующих элементов справочника Контрагенты" — определяет, по каким данным будет осуществляться поиск контрагентов. Выберите способ поиска "По наименованию", если данные контрагента в выгружаемых заказах из интернет-магазина не содержат ИНН и КПП.

     * "Вид номенклатуры для товаров" — вид номенклатуры, используемый при создании заказа в 1С.

     * "Вид номенклатуры для услуг" — вид номенклатуры услуг, используемый при создании заказа в 1С.

     * "Единица измерения" — единица измерения товаров, используемая при создании заказа в 1С.

     * "Группа номенклатуры" — группа, в которую будут добавляться товары из интернет-магазина, выгружаемые в заказе.

     * "Причина отмены заказа" — причина, присваиваемая отмененным заказам.

     * "Соответствие статусов заказов в информационной базе и на сайте" — таблица для указания соответствия статусов заказа интернет-магазина и 1С.

       .. important::

           При обмене 1С пытается выполнить соответствие статусов заказа. Данный функционал не реализован до конца на стороне 1С.

    .. fancybox:: img/order1c_005.png
        :alt: Обмен заказами 1C и CS-Cart

    .. fancybox:: img/order1c_006.png
        :alt: Обмен заказами 1C и CS-Cart

Настройки в интернет-магазине
-----------------------------

1. Установите модуль "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365" (:doc:`см. "Установка модулей" <../../../../1manage_addons>`). 

   .. hint:: 

       Панель администратора → Верхнее меню → Модули → Управление модулями → Просмотреть все доступные модули → "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365"

   .. fancybox:: img/order1c_007.png
       :alt: Обмен заказами 1C и CS-Cart

2. После установки модуля откройте его настройки. Нажмите на название модуля и переключитесь на вкладку "Настройки заказов":

   * "Включать отдельно стоимость доставки заказа для 1С" — если у заказа задана доставка, то при включении данной настройки доставка будет выгружаться в заказе в виде отдельной услуги.

   * "Выгружать опции товара" — если товары в заказе содержат опцию, то при включении данной настройки будут выгружаться опции товаров.

   * "Выгружать с номера" — задает номер первого выгружаемого заказа. Выгружаться будет этот заказ и все более поздние заказы.

   * "Загружать статусы заказов" — если включить эту настройку, то статусы у заказов в интернет-магазине будут обновлены в соответствии с файлом заказов 1С.

   * "Выгружать статусы заказов" — если включить эту настройку, то из интернет-магазина в 1С будут передаваться статусы выгружаемых заказов.

   * "Статусы выгружаемых заказов" — выгружать заказы только с указанными статусами. Если не выбран ни один из статусов, то будут выгружены все заказы, независимо от статуса.

   .. fancybox:: img/order1c_008.png
       :alt: Обмен заказами 1C и CS-Cart

3. Для просмотра заказов, выгружаемых в 1С, введите в браузере следующий URL: ``ваш_домен/exim_1c?type=sale&mode=query``

   .. fancybox:: img/order1c_009.png
       :alt: Обмен заказами 1C и CS-Cart

Обмен заказами
--------------

1. Откройте в 1С созданный узел обмена и выполните обмен.

   .. fancybox:: img/order1c_010.png
       :alt: Обмен заказами 1C и CS-Cart

2. Откройте в 1С заказы клиента и проверьте, выгрузились ли заказы из интернет-магазина.

   .. hint::

       Продажи → Заказы клиентов

   .. fancybox:: img/order1c_011.png
       :alt: Обмен заказами 1C и CS-Cart
