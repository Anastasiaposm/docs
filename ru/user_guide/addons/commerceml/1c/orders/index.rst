********************************************
Обмен заказами между интернет-магазином и 1С
********************************************

Инструкция по обмену заказами между 1С и интернет-магазином на платформе CS-Cart.

.. contents:: Содержание
    :local: 
    :depth: 3


Настройки в 1С
--------------

1.  Откройте базу данных, с которой будет производиться обмен.

    .. fancybox:: img/order1c_001.png
        :alt: Обмен заказами 1C и CS-Cart

2.  Проверьте настройки 1С (см. :doc:`Настройки обмена </user_guide/addons/commerceml/1c/instruction/index>`).

3.  Создайте типовое соглашение (см. :doc:`Настройки обмена </user_guide/addons/commerceml/1c/instruction/index>`).

4.  Создайте узел обмена. В основных настройках узла включите настройку "Обмен заказами".

    .. fancybox:: img/order1c_002.png
        :alt: Обмен заказами 1C и CS-Cart

    Во вкладке "Обмен заказами" выполните настройку:

    *   "Дата заказа на сайте" - для создания реквизита используемого для значения даты заказа откройте "Общие настройки".

    .. note::

        Администрирование → Общие настройки

    В окне "Общие настройки" нажмите на ссылку "Дополнительные реквизиты".

        .. fancybox:: img/order1c_003.png
            :alt: Обмен заказами 1C и CS-Cart

    В окне "Дополнительные реквизиты" перейдите в папку "Заказ клиента" и создайте дополнительный реквизит

        .. note::
            Все действия → Добавить → Новый

        .. fancybox:: img/order1c_004.png
            :alt: Обмен заказами 1C и CS-Cart

    *   "Номер заказа на сайте" - создайте реквизит для значения номера заказа, аналогично созданию реквизита для "Дата заказа на сайте".

    *   "Соглашение" - выберите созданное типовое соглашение.

    *   "Организация" - выберите организацию осуществляющую заказ.

    *   "Склад" - выберите склад, используемый при создании заказа в 1С.

    *   "Менеджер" - выберите менеджера, который будет использоваться при создании заказа в 1С.

    *   "Способ поиска существующих элементов справочника Контрагенты" - определяет по каким данным будет осуществляться поиск контрагентов. Выберите способ поиска "По наименованию", если данные контрагента в выгружаемых заказах из интернет-магазина не содержат ИНН и КПП.

    *   "Вид номенклатуры для товаров" - вид номенклатуры, используемый при создании заказа в 1С.

    *   "Вид номенклатуры для услуг" - вид номенклатуры услуг, используемый при создании заказа в 1С.

    *   "Единица измерения" - единица измерения товаров, используемая при создании заказа в 1С.

    *   "Группа номенклатуры" - группа, в которую будут добавляться товары из интернет-магазина выгружаемые в заказе.

    *   "Причина отмены заказа" - причина присваиваемая отмененым заказам.

    *   "Соответствие статусов заказов в информационной базе и на сайте" - таблица для указания соответствия статусов заказа интернет-магазина и 1С.

    .. important::

        При обмене 1С пытается выполнить соответствие статусов заказа. Данный функционал не реализован до конца на стороне 1С.

    .. fancybox:: img/order1c_005.png
        :alt: Обмен заказами 1C и CS-Cart

    .. fancybox:: img/order1c_006.png
        :alt: Обмен заказами 1C и CS-Cart

Настройки в интернет-магазине
-----------------------------

1.  Для обмена заказами 1С и интернет-магазином установите модуль "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365" (:doc:`см. "Установка модулей" </user_guide/addons/1manage_addons>`). 

.. note:: 

    Панель администратора → Верхнее меню → Модули → Управление модулями → "CommerceML – синхронизация интернет-магазина с 1С, МойСклад, Класс365"

.. fancybox:: img/order1c_007.png
    :alt: Обмен заказами 1C и CS-Cart

2.  После установки модуля откройте его настройки. Вкладка "Настройки заказов" содержит настройки для выгрузки заказов.

"Настройки заказов":

    *   "Включать отдельно стоимость доставки заказа для 1С" - если у заказа задана доставка, то при включении данной настройки, доставка будет выгружаться в заказе в виде отдельной услуги.

    *   "Выгружать опции товара" - если товары в заказе содержат опцию, то при включении данной настройки будут выгружаться опции товаров.

    *   "Выгружать с номера" - задает номер, с которого будут выгружаться заказы.

    *   "Загружать статусы заказов" - при обмене заказами, в интернет-магазин будут загружаться статусы заказов из выгружаемого файла заказов 1С.

    *   "Выгружать статусы заказов" - включает выгрузку статусов заказа из интернет-магазина в 1С.

    *   "Статусы выгружаемых заказов" - устанавливает выгрузку заказов с указанными статусами, если ни один из статусов не выбран, то будут выгружены все заказы не зависимо от статуса.

.. fancybox:: img/order1c_008.png
    :alt: Обмен заказами 1C и CS-Cart

3.  Для просмотра выгружаемых в 1С заказов, введите в браузере url ``домен/exim_1c?type=sale&mode=query``

.. fancybox:: img/order1c_009.png
    :alt: Обмен заказами 1C и CS-Cart

Обмен заказами
--------------

1.  Откройте в 1С созданный узел обмена и выполните обмен.

.. fancybox:: img/order1c_010.png
    :alt: Обмен заказами 1C и CS-Cart

2.  Откройте в 1С заказы клиента и проверьте выгрузились ли заказы из интернет магазина

.. note::

    Продажи → Заказы клиентов

.. fancybox:: img/order1c_011.png
    :alt: Обмен заказами 1C и CS-Cart

