*******************************************************
Исключения (разрешённые и недоступные комбинации опций)
*******************************************************

Вы можете указать, какие сочетания вариантов :doc:`опций товара <product_options>` доступны или недоступны для покупателей. Например, если вы продаёте футболки разных цветов и размеров, вы можете сделать определённые сочетания цветов и размеров недоступными, или же наоборот, сделать доступными только эти сочетания цветов и размеров. Всё это делается с помощью **исключений**.

.. important::

    С помощью исключений можно задать, какие :doc:`комбинации опций <option_combinations>` покупатель сможет добавить в корзину.

======================
Типы отображения опций
======================

На странице редактирования товара есть настройка **Тип опций**. Она может быть полезна при настройке исключений. У настройки **Тип опций** есть 2 возможных варианта: 

  * **Одновременно** — варианты опций на странице товара можно выбирать в любом порядке, и у каждой опции изначально выбран один из вариантов. Это значение по умолчанию.

  * **Последовательно** — варианты опций будут выбираться последовательно. Сначала пользователь выбирает вариант для первой опции из списка, потом для второй, и т.д.

  .. note::

      При последовательных опциях важна позиция опций относительно друг друга. Ее можно изменить во всплывающем окне редактирования опции в поле **Позиция**.

===============
Типы исключений
===============

Исключения ведут себя по-разному в зависимости от типа. Тип можно задать для каждого товара отдельно:

#. Откройте страницу **Товары → Товары**.

#. Нажмите на название товара, который вы хотите отредактировать.

#. Найдите настройку **Тип исключений** и выберите её значение:

   * **Разрешение** — покупателям будут доступны только исключения; остальные сочетания вариантов опций будут недоступны.

   * **Запрещение** — исключения не будут доступны покупателям; другие сочетания вариантов опций будут доступны.

#. Нажмите кнопку **Сохранить** в правом верхнем углу.

   .. note::

       Если вы измените значение настройки **Тип исключений** у товара, то изменится тип всех исключений, созданных для этого товара.

   .. fancybox:: img/exceptions_type.png
       :alt: У одного товара все исключения всегда одного типа.

=======================
Как добавить исключение
=======================

#. Откройте страницу **Товары → Товары**.

#. Нажмите на название товара, который вы хотите отредактировать.

#. Перейдите на вкладку **Опции**. 

#. Нажмите на кнопку **Разрешённые комбинации** или **Недоступные комбинации**.

   .. hint::

       Название кнопки зависит от того, какой **Тип исключений** выбран у товара.

   .. fancybox:: img/forbidden_comb_01.png
       :alt: Кнопка "Недоступные комбинации" находится на вкладке "Опции" над списком опций.

#. Нажмите кнопку **+**.

#. Откроется всплывающее окно. Там вы можете указать, какие сочетания вариантов опций являются исключениями. Используйте кнопки, чтобы добавлять, клонировать, и удалять исключения.

   .. note::

       В составе исключений могут быть только опции с типом **Список вариантов**, **Радиогруппа** и **Флажок**. Только у этих опций есть набор заранее известных вариантов, по которым можно составить исключающее правило.

#. Нажмите кнопку **Создать**.

   .. fancybox:: img/forbidden_comb_02.png
       :alt: Выберите варианты опций, из которых будет состоять исключение.

   Комбинации будут добавлены в список исключений:

   * Если у товара есть **разрешённые комбинации**, то покупатели смогут добавить в корзину только их.

   * Если у товара есть **недоступные комбинации**, то покупатели не смогут добавить эти комбинации в корзину.

.. important::

    Если для товара уже созданы исключения, то создание или удаление опций не приведёт к автоматическому пересчету исключений. В случае добавления новой опции, во всех исключениях эта опция становится в значение *"Можно выбрать любой вариант"*.

=================
Пример исключений
=================

Допустим мы создаем кроссовки с двумя опциями: 

* *Размер:* 41, 42, 43; 

* *Цвет:* чёрный/желтый, синий, хаки. 

При этом, *43* размер не может быть из выбранных цветов, а имеет свою уникальную фирменную расцветку. К тому же у нас кончились все кроссовки с цветом *хаки*.

Таким образом, мы должны будем создать следующие исключения (тип *Запрещение*): 

* **Размер: 43; Цвет: "Нельзя выбрать ни один из вариантов"**. Это означает, что если будет выбран *43* размер, то поле *"Цвет"* будет недоступно.

* **Размер: "Можно выбрать любой вариант"; Цвет: Хаки**. Тем самым мы ставим запрещающее условие: если выбран цвет *Хаки*, то покупатель не сможет выбрать ни один из размеров. Если размер является обязательной опцией (а так и должно быть), то покупатель не сможет добавить товар в корзину.

==================================
Как исключения выглядят на витрине
==================================

На странице **Настройки → Общие** есть настройка **Стиль исключений**; она определяет, как исключения выглядят на витрине. Есть два возможных значения:

* **Скрыть исключённые варианты** (это значение по умолчанию) — некоторые варианты опций будут скрыты, чтобы покупатели не смогли выбрать исключение.

  Например, вы продаёте футболки с опциями *Цвет* и *Размер*. Если вы делаете комбинацию *белая футболка XXL* недоступной с помощью исключений, то при выборе размера *XXL* в списке цветов не появится *белый*, и наоборот.

* **Показывать предупреждение об исключении** — появятся все варианты опций. Если покупатель выберет недоступную комбинацию опций, появится следующее сообщение: *К сожалению, эта комбинация недоступна*. Покупатели не смогут добавить недоступную комбинацию в корзину.
