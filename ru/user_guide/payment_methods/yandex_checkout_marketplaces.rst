*************************
Яндекс.Касса для платформ
*************************

Принцип работы
==============

#. Покупатель добавляет в корзину товары от разных продавцов.

#. На странице оформления заказа покупатель выбирает способ оплаты “Яндекс.Касса для платформ”.

#. При нажатии кнопки “Оформить заказ” он попадает на страницу Яндекс.Кассы, и уже там выбирает `подходящий способ оплаты <https://kassa.yandex.ru/help/payments/accept-methods.html>`_.

   .. fancybox:: img/payment_yandex.png
       :alt: Yandex payment

   .. note::
       Такой принцип работы описан на сайте Яндекс.Кассы как `"Сценарий 1: Выбор способа оплаты на странице Кассы" <https://kassa.yandex.ru/pay_by_yandex/#1>`_. Его преимущество в том, что `когда Яндекс.Касса добавит новые способы оплаты, то и вы сможете их быстро добавить <https://kassa.yandex.ru/help/payments/accept-methods.html#accept-methods__adding-new>`_.

#. Покупатель платит всего один раз, а Яндекс.Касса сама производит сплитование и отправляет деньги продавцам. Комиссия перечисляется владельцу маркетплейса.

Настройка
=========

.. important::
    Для работы с Яндекс.Кассой `на вашем сервере должен быть установлен SSL-сертификат <https://kassa.yandex.ru/tech/ssl.html>`_. Можно использовать самоподписанный сертификат.


Шаг 1. Настройте способ оплаты
------------------------------

#. :doc:`Установите модуль </user_guide/addons/1manage_addons>` ../user_guide/addons/yandex_checkout/index:.

#. `Подключите ваш маркетплейс к Яндекс.Кассе. <https://money.yandex.ru/joinups/?cms_name=cscart>`_

#. :doc:`Создайте новый cпособ оплаты <adding_payment>` с процессором *Яндекс.Касса для платформ*.

#. Перейдите на вкладку **Настроить** нового способа оплаты и выполните настройку:

   .. fancybox:: img/add_payment_method_yandex_for_marketplace.png
       :alt: Yandex for marketplace settings

   * **URL для уведомлений** — скопируйте его отсюда в настройки магазина в личном кабинете Яндекс.Кассы. Так Яндекс.Касса будет знать, куда сообщать о транзакциях.

   * **shopId** и **секретный ключ** — возьмите их из личного кабинета Яндекс.Кассы и скопируйте сюда. Так Яндекс.Касса точно будет знать, что это именно ваш маркетплейс.

   * **Отправлять данные для чеков в Яндекс.Кассу (54-ФЗ)** — включите эту настройку, если за взаимодействие с онлайн-кассой у вас отвечает Яндекс.Касса.

   * **Статус заказа для формирования итогового чека** — статус заказа, когда покупатель получил то, за что заплатил. Когда заказ получает этот статус, Яндекс.Касса сформирует чек зачёта предоплаты.

   * **Валюта** — выберите валюту, которая используется в учётной записи Яндекс.Кассы. Она должна совпадать с базовой валютой вашего маркетплейса.

#. Нажмите кнопку “Сохранить”.

Шаг 2. Добавьте продавцов
-------------------------

#. Убедитесь, что продавцы подключены к Яндекс.Кассе. Запросите их идентификаторы.

#. Откройте вкладку **Продавцы**.

#. Щелкните по названию продавца, чтобы открыть его настройки, и откройте вкладку **Модули**.

   .. fancybox:: img/add_new_vendor.png
       :alt: Add new vendor's shopid

#. В поле **shopId** введите идентификатор продавца.

#. В поле **Комиссия маркетплейса** укажите комиссию. Обратите внимание, что это значение должно совпадать с комиссией, настроенной на стороне Яндекс.Кассы.

#. Нажмите “Сохранить”.

   .. note::
       Способ оплаты “Яндекс.Касса для платформ” будет доступен покупателю, только если все продавцы, чьи товары у него в корзине, подключены к Яндекс.Кассе.