***************
Яндекс.Доставка
***************

.. epigraph::

   Сервис работает с несколькими курьерскими службами и помогает организовать перевозку товаров из Москвы и Подмосковья во все регионы России.
   Перевозка товаров при работе с Яндекс.Доставкой в среднем стоит столько же, сколько при работе с курьерскими службами напрямую.

   -- |yandex_delivery|

.. |yandex_delivery| raw:: html

    <!--noindex--><a href="https://delivery.yandex.ru/promo/" target="_blank" rel="nofollow">Официальный сайт</a><!--/noindex-->


.. note::

    Модуль находиться на стадии разработки. На данный момент реализована доставка в точки самовывоза.


Ключи доступа
=============

1.  Откройте в браузере страницу delivery.yandex.ru и перейдите на страницу настроек:

    .. fancybox:: img/go_to_settings.png
        :alt: переход в настройки

3.  Откройте вкладку "Интеграция" и нажмите на ссылку "получить".

    .. fancybox:: img/get_api_keys.png
        :alt: Получение ключей

4. Скопируйте и вставьте данные в настройки модуля CS-Cart. В первом поле отображаются "Ключи API", а во втором значения "Client ids"

    .. fancybox:: img/copy_api_keys.png
        :alt: Копирование ключей


Настрока модуля
===============

1. Установите модуль

2. В настройках модуля указжите значения, который получили в окне "Получить API-ключи" на сайте delivery.yandex.ru

    .. fancybox:: img/settings_addon.png
        :alt: Добавление нового способа доставки


Добавление способа доставки
===========================

1. Создайте новый способ доставки (:doc:`см. "Создание способа доставки" </user_guide/shipping_and_taxes/shipping_methods/add_shipping_method>`).

    Настройки нового способа доставки:

    .. list-table::
        :stub-columns: 1
        :widths: 10 30

        *   -   Расчет тарифа
            -   В реальном времени

        *   -   Служба доставки
            -   Яндекс.Доставка

    .. fancybox:: img/add_shipping.png
        :alt: Добавление нового способа доставки

2. Выполните настройку нового способа доставки во вкладке “Настроить”.

    .. fancybox:: img/settings_shipping.png
        :alt: Добавление нового способа доставки

    .. list-table::
        :stub-columns: 1
        :widths: 20 30

        *   -   Отправитель, склад, реквизиты

            -   Ваши данные, которые вы настраиваете на стороне Яндекса.

        *   -   Ширина упаковки, высота упаковки, длина упаковки

            -   Размеры посылки.

        *   -   Сортировка точек самовывоза

            -   Когда покупатель указал адрес доставки, то в списках доступных точек самовывоза доступны самые близкие от него. Это удобно при использовании следующей настройки.

        *   -   Количество отображаемых точек самовывоза

            -   В больших городах много точек самовывоза. Этой настройкой можно ограничить их количество в списке, оставив только ближайшие к клиенту точки самовывоза.

        *   -   Отправить из

            -   Город, из которого Яндекс.Доставка отправит товар. Если ваш склад находится в Московской области, то выберите *Москва*, а если в Ленинградской области, то *Санкт-Петербург*.

        *   -   Тип доставки

            -   Выбор доступных способов доставки для самовывоза.

        *   -   Тип отображения

            -   На данный момент доступен только "Внутренний". Это шаблон отображения карты и выбора доставки.

        *   -   Журнал событий

            -   По умолчанию запись в журнал событий отключена. Яндекс присылает большие объемы данных, поэтому включение журнала событий может привести к медленное работе магазина при оформлении заказа.

3. Проверьте работу автоматического расчёта.

    .. fancybox:: img/test.png
        :alt: Проверка


Оформление заказа
=================

1. Добавляем товар в корзину и переходим на оформление заказа.

2. На третьем шаге оформления заказа выбираем способ доставки *Яндекс.Доставка*.

    .. fancybox:: img/all_points.png
        :alt: Добавление нового способа доставки

    .. fancybox:: img/select_point.png
        :alt: Добавление нового способа доставки

Создание заказа на Яндекс.Доставке
==================================

После того, как покупатель оформит заказ в магазине, администратор может создать соответствующий заказ на Яндекс.Доставке. 

.. important::

    Для создания заказа на Яндекс.Доставке необходимо, чтобы в заказе был указан сотовый телефон покупателя. Стоимость товаров должна быть целочисленной.

1. Откройте страницу **Заказы → Все заказы**.

2. Найдите и откройте заказ, для которого хотите создать заказ на Яндекс.Доставке.

3. Создайте отгрузку. Есть два варианта, как это сделать:

   * В поле **Перевозчик** в правой части экрана выберите вариант *Яндекс.Доставка*. Затем нажмите **Сохранить изменения**.

   * Нажмите **Создать отдельную отгрузку**, в появившемся окне выберите в поле **Перевозчик** вариант *Яндекс.Доставка* и нажмите кнопку **Создать**.

   .. fancybox:: img/yandex_delivery.png
       :alt: Создание отгрузки для Яндекс.Доставки в CS-Cart.

   .. note::

       Не рекомендуем на этом этапе отправлять покупателю письмо о создании отгрузки. Это лучше сделать чуть позже, в шаге 5 — так мы отправим одно уведомление вместо двух, а в уведомлении уже будет номер отслеживания от Яндекс.Доставки.

4. После того, как отгрузка создана, на странице заказа появится кнопка **Оформить заказ Яндекс.Доставки**. Нажмите на неё.

   .. fancybox:: img/create_yandex_delivery_order.png
       :alt: Создание заказа на Яндекс.Доставке в CS-Cart.

5. Откроется всплывающее окно, где можно будет настроить заказ:

   * Вкладка **Общее**: выберите отправителя, склад и реквизиты. Добавьте комментарий, если необходимо. Можно отправить покупателю уведомление об отправке (уже с номером отслеживания).

   .. fancybox:: img/yd_general.png
       :alt: Яндекс.Доставка в CS-Cart: отправитель, склад, реквизиты, комментарий, уведомление об отправке.

   * Вкладка **Поставка**: выберите дату и способ отгрузки. Здесь есть ещё два важных поля:

     * **Оценочная стоимость** — сумма, которую вам вернут, если при перевозке товаров с ними что-то произойдет.

     * **Предоплата** — сумма, которую покупатель уже уплатил за заказ.

   .. fancybox:: img/yd_shipping.png
       :alt: Яндекс.Доставка в CS-Cart: дата и способ отгрузки, предоплата, оценочная стоимость.
 
   * Вкладка **Информация о пользователе**: введите имя, фамилию и номер мобильного телефона покупателя.

   .. fancybox:: img/yd_customer.png
       :alt: Яндекс.Доставка в CS-Cart: имя, фамилия и номер мобильного телефона покупателя.

5. Нажмите кнопку **Создать**. Заказ на Яндекс.Доставке будет создан, а на странице заказа в CS-Cart появится номер отслеживания.

.. fancybox:: img/order_on_yandex_delivery.png
    :alt: Заказ из CS-Cart на Яндекс.Доставке.

.. important::

    В CS-Cart информация о статусе заказа на Яндекс.Доставке обновляется автоматически, но **только когда пользователь или администратор открывает в CS-Cart страницу соответствующего заказа** (но не список отгрузок).

.. fancybox:: img/order_on_yandex_delivery.png
    :alt: Статус заказа на Яндекс.Доставке в CS-Cart обновляется автоматически, если открыть страницу заказа в CS-Cart.

.. hint::

    Чтобы найти все отгрузки, для которых был создан заказ на Яндекс.Доставке, откройте страницу **Заказы → Отгрузки** и выберите **Заказы Яндекс.Доставки** в панели справа.

.. fancybox:: img/yandex_shipments.png
    :alt: Список отгрузок CS-Cart, связанных с заказами на Яндекс.Доставке.
