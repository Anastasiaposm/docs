Служба доставки СДЭК
--------------------

.. note::

    Начиная с версии **CS-Cart 4.6.2**, для корректной работы службы доставки СДЭК необходимо, прежде всего, настроить существующие налоги с помощью :doc:`модуля "Налоговые ставки РФ" </user_guide/addons/rus_taxes/index>`.

.. note::

    Ошибка "Сумма НДС не соответствует указанной ставке НДС" отображается, когда налоги указаны неверно. Например, если администратор указал налоговую ставку 0%, а настроил - 18%.

Описание
========

Автоматический расчёт стоимости доставки СДЭК входит в "Русскую версию CS-Cart".

.. epigraph::

    Функциональные возможности:

    *   Автоматический калькулятор стоимости доставки СДЭК
    *   Передача информации по заказу в систему СДЭК
    *   Отслеживание заказа
    *   Формирование печатной формы квитанции к заказу
    *   Получение списка пунктов выдачи заказов

    -- Официальный сайт


Официальный сайт:  |link|

.. |link| raw:: html

   <!--noindex--><a href="http://edostavka.ru" target="_blank" rel="nofollow">SDEK.ru</a><!--/noindex-->

Настройка
=========

1.  Заключите договор с менеджером СДЭК.

2.  Установите модуль "Служба доставки — СДЭК".

3.  Создайте новый способ доставки (:doc:`см. "Создание способа доставки" </user_guide/shipping_and_taxes/shipping_methods/add_shipping_method>`).

    Настройки нового способа доставки:

    .. list-table::
        :stub-columns: 1
        :widths: 10 30

        *   -   Расчет тарифа
            -   В реальном времени

        *   -   Служба доставки
            -   СДЭК.

        *   -   Другие настройки
            -   На ваше усмотрение

    .. fancybox:: img/sdek_shippings_01.png
        :alt: sdek

4.  Выполните настройку нового способа доставки во вкладке "Настроить".

    Необходимые настройки:

    *   Логин для доступа к серверу расчетов

    *   Пароль для доступа к серверу расчетов

    *   Количество дней, через сколько будет произведена планируемая отправка заказа

    *   Город-отправитель

    *   ID города - заполняется автоматически при нажатии на ссылку "Получить ID города". Определение ID города зависит от "Страны" в "Настройки" - "Компания".

    *   Почтовый индекс города-отправителя (заполнять не обязательно, если задан город-отправитель)

    *   Выбор доступных тарифов (используются два тарифа экспресс-лайт "Склад-Склад" и "Склад-Дверь")

    *   Ширина упаковки, см

    *   Высота упаковки, см

    *   Длина упаковки, см

    Логин и пароль для расчета вы можете узнать у менеджера СДЭК.

    .. fancybox:: img/sdek_shippings_02.png
        :alt: sdek

5.  Проверьте работу автоматического расчёта.

    .. fancybox:: img/sdek_shippings_03.png
        :alt: sdek

   Теперь на витрине должен отображаться новый способ доставки, которым сможет воспользоваться покупатель. Если выбран один из тарифов "Склад — Склад", то покупатели увидят карту и смогут выбрать подходящий пункт выдачи заказов.

   .. fancybox:: img/sdek_pickup_1.png
       :alt: Пункты самовывоза в СДЭК.

   .. fancybox:: img/sdek_pickup_2.png
       :alt: Выбранный пункт самовывоза в СДЭК.

Передача информации о заказе в СДЭК
===================================

1. Откройте страницу **Заказы → Все заказы**.

2. Найдите и откройте заказ, информацию о котором нужно передать в СДЭК.

3. Сначала нужно создать отгрузку в CS-Cart. Для этого нажмите **Создать отдельную отгрузку**.

   .. fancybox:: img/sdek_order_details.png
       :alt: Отгрузки для СДЭК в CS-Cart создаются на странице заказа.

4. Заполните информацию об отгрузке в появившемся окне:

   * **Способ доставки** — выберите способ доставки, который мы создали для СДЭК (см. раздел **Настройка** выше).

   * **Перевозчик** — выберите вариант *СДЭК*.

   .. fancybox:: img/create_shipment_for_sdek.png
       :alt: Страница создания отгрузки в CS-Cart.

5. Нажмите кнопку **Создать**.

   .. hint::

       Не рекомендуем на этом этапе отправлять покупателю письмо о создании отгрузки. Это лучше сделать чуть позже, в шаге 7 — так мы отправим одно уведомление вместо двух, а в уведомлении уже будет номер отслеживания от СДЭК.

6. После того, как отгрузка будет создана, на странице заказа появится кнопка **Сформировать отгрузку**. Нажмите на неё.

   .. fancybox:: img/create_sdek_shipment.png
       :alt: Создание отгрузки для СДЭК в CS-Cart.

7. Откроется всплывающее окно, в котором вы сможете оформить отгрузку в СДЭК. В окне есть несколько вкладок:

   * Вкладка **Общее**:

     * **Адрес доставки** — адрес покупателя (ecли для способа доставки СДЭК выбран тариф *"Склад — Дверь"*) или список пунктов выдачи заказов (ecли для способа доставки СДЭК выбран тариф *"Склад — Склад"*).

     * **Номер посылки** — номер упаковки, который будет присвоен посылке.

     * **Стоимость доставки** — сумма, которую покупатель оплатит за доставку; рассчитывается автоматически на основе товаров в отгрузке; данную стоимость можно изменять.

     * **Комментарий** — комментарий к заказу, который необходимо передать в службу доставки СДЭК.

     * **Наложенный платеж** — дополнительная сумма, которую покупатель платит продавцу при получении заказа.

     * **Включить наложенный платеж** — поставьте галочку, если хотите, чтобы покупатель при получении заказа уплатил сумму из поля **Наложенный платеж**. Иначе эта сумма никак не будет учитываться.

     * **Включить стоимость товара** — поставьте галочку, если хотите включить стоимость товара в наложенный платеж. Если включена эта настройка и наложенный платёж, то стоимость наложенного платежа будет складываться из стоимости товара и стоимости, указанной в поле **Наложенный платеж**.

   .. fancybox:: img/sdek_shipment_form_1.png
       :alt: Форма создания отгрузки СДЭК в CS-Cart.
 
   * Вкладка **Позвонить адресату**:  введите данные для уведомления покупателя о поступлении заказа; если не указывать время доставки, то данные с этой вкладки учтены не будут.

   .. fancybox:: img/sdek_shipment_form_2.png
       :alt: Форма создания отгрузки СДЭК в CS-Cart.

   * Вкладка **Вызов курьера**: введите данные для курьерской доставки; если не задать время ожидания курьера, то данные с этой вкладки учтены не будут.

   .. fancybox:: img/sdek_shipment_form_3.png
       :alt: Форма создания отгрузки СДЭК в CS-Cart.

8. Когда вы заполните данные во всех вкладках, нажмите кнопку **Сохранить**. Информация будет передана в СДЭК, а на странице заказа в CS-Cart появится номер отслеживания. Рядом со статусом доставки будет иконка редактирования. С ее помощью вы сможете изменить данные на вкладках **Позвонить адресату** и **Вызов курьера**, если возникнет необходимость.

   .. fancybox:: img/sdek_shipment_status.png
       :alt: Номер отслеживания отгрузки СДЭК в CS-Cart.

.. warning::

    Если удалить отгрузку в или заказ CS-Cart, то будет удалена и информация о соответствующих им отгрузках СДЭК.

.. hint::

    Чтобы найти все отгрузки, для которых была сформирована отгрузка в СДЭК, откройте страницу **Заказы → Отгрузки** и выберите **Заказы службы доставки СДЭК** в панели справа.

.. fancybox:: img/sdek_shipment_list.png
    :alt: Список отгрузок СДЭК в CS-Cart.

.. hint::

    Для просмотра квитанции отгрузки СДЭК откройте нужную отгрузку, нажмите на кнопку с изображением шестерёнки и выберите пункт **Квитанция** в выпадающем меню.

.. fancybox:: img/sdek_document.png
    :alt: Получение квитанции СДЭК в CS-Cart.
